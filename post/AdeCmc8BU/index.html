<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<meta name="referrer" content="never">
<meta name="keywords" content="">
<meta name="description" content="欢迎访问[tianxia]的个人博客">
<meta name="author" content="kveln">
<title>elasticSearch查询语句 | tianxia</title>
<link rel="stylesheet" href="https://tinaxiawuhao.github.io/resource/bootstrap.min.css">
<link href="https://tinaxiawuhao.github.io/resource/all.min.css" rel="stylesheet">
<link rel="alternate" type="application/rss+xml" title="elasticSearch查询语句 | tianxia » Feed"
  href="https://tinaxiawuhao.github.io/atom.xml">
<link rel="stylesheet"
  href="https://tinaxiawuhao.github.io/resource/androidstudio.min.css">
<link href="https://tinaxiawuhao.github.io/styles/main.css" rel="stylesheet">
<script src="https://tinaxiawuhao.github.io/resource/jquery.min.js"></script>

<script src="https://tinaxiawuhao.github.io/resource/highlight.min.js"></script>

<link rel="stylesheet" href="https://tinaxiawuhao.github.io/resource/live2d.css">

<script>hljs.initHighlightingOnLoad();</script>

  <meta property="og:description" content="elasticSearch查询语句" />
  <meta property="og:url" content="https://tinaxiawuhao.github.io/post/AdeCmc8BU/" />
  <meta property="og:locale" content="zh-CN" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="tianxia" />
  <!-- <script src="../assets/styles/scripts/tocScript.js"></script> -->
</head>

<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="https://tinaxiawuhao.github.io">tianxia</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
      data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
      aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        
        <li class="nav-item">
          
          <a class="nav-link" href="/">首页</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/archives">归档</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/tags">标签</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/post/about">关于</a>
          
        </li>
        
        <li class="nav-item">
          <div class="gridea-search-container">
            <form id="gridea-search-form" style="position: relative" data-update="1663068709855"
              action="/search/index.html">
              <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
              <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>
  <!-- Page Header -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="https://tinaxiawuhao.github.io">tianxia</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
      data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
      aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        
        <li class="nav-item">
          
          <a class="nav-link" href="/">首页</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/archives">归档</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/tags">标签</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/post/about">关于</a>
          
        </li>
        
        <li class="nav-item">
          <div class="gridea-search-container">
            <form id="gridea-search-form" style="position: relative" data-update="1663068709855"
              action="/search/index.html">
              <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
              <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>
<header class="masthead" style="background-image: url('https://tinaxiawuhao.github.io/media/images/home-bg.jpg')">
  <div class="overlay"></div>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        
          <!-- 没Title为其他页面Header -->
          
            <!-- 没Title并且有headerType为Post：文章Header -->
            <div class="post-heading">
              <span class="tags">
                
                <a href="https://tinaxiawuhao.github.io/tag/4iaIun1eax/" class="tag">ELK</a>
                
              </span>
              <h1>elasticSearch查询语句</h1>
              <span class="meta">
                Posted on
                2021-05-28，38 min read
              </span>
            </div>
          
        
      </div>
    </div>
  </div>
</header>
  <!-- Post Content -->
  <article id="post-content-article">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto post-content-container">
          
          <img class="post-feature-header-image" src="https://tinaxiawuhao.github.io/post-images/AdeCmc8BU.png" alt="封面图">
          </img>
          
          <!-- more -->
<blockquote>
<p>原文：https://distributedbytes.timojo.com/2016/07/23-useful-elasticsearch-example-queries.html<br>
作者：Tim Ojo</p>
</blockquote>
<p>为了演示不同类型的 ElasticSearch 的查询，我们将使用以下字段搜索书籍文档的集合（ title（标题）, authors（作者）, summary（摘要）, publish_date（发布日期）和 num_reviews（浏览数））。</p>
<p>在这之前，首先我们应该先创建一个新的索引（index），并批量导入一些文档：</p>
<p>创建索引：</p>
<pre><code class="language-json">PUT /bookdb_index
    { &quot;settings&quot;: { &quot;number_of_shards&quot;: 1 }} 
</code></pre>
<p>批量上传文档：</p>
<pre><code class="language-json">POST /bookdb_index/book/_bulk
    { &quot;index&quot;: { &quot;_id&quot;: 1 }}
    { &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;, &quot;authors&quot;: [&quot;clinton gormley&quot;, &quot;zachary tong&quot;], &quot;summary&quot; : &quot;A distibuted real-time search and analytics engine&quot;, &quot;publish_date&quot; : &quot;2015-02-07&quot;, &quot;num_reviews&quot;: 20, &quot;publisher&quot;: &quot;oreilly&quot; }
    { &quot;index&quot;: { &quot;_id&quot;: 2 }}
    { &quot;title&quot;: &quot;Taming Text: How to Find, Organize, and Manipulate It&quot;, &quot;authors&quot;: [&quot;grant ingersoll&quot;, &quot;thomas morton&quot;, &quot;drew farris&quot;], &quot;summary&quot; : &quot;organize text using approaches such as full-text search, proper name recognition, clustering, tagging, information extraction, and summarization&quot;, &quot;publish_date&quot; : &quot;2013-01-24&quot;, &quot;num_reviews&quot;: 12, &quot;publisher&quot;: &quot;manning&quot; }
    { &quot;index&quot;: { &quot;_id&quot;: 3 }}
    { &quot;title&quot;: &quot;Elasticsearch in Action&quot;, &quot;authors&quot;: [&quot;radu gheorge&quot;, &quot;matthew lee hinman&quot;, &quot;roy russo&quot;], &quot;summary&quot; : &quot;build scalable search applications using Elasticsearch without having to do complex low-level programming or understand advanced data science algorithms&quot;, &quot;publish_date&quot; : &quot;2015-12-03&quot;, &quot;num_reviews&quot;: 18, &quot;publisher&quot;: &quot;manning&quot; }
    { &quot;index&quot;: { &quot;_id&quot;: 4 }}
    { &quot;title&quot;: &quot;Solr in Action&quot;, &quot;authors&quot;: [&quot;trey grainger&quot;, &quot;timothy potter&quot;], &quot;summary&quot; : &quot;Comprehensive guide to implementing a scalable search engine using Apache Solr&quot;, &quot;publish_date&quot; : &quot;2014-04-05&quot;, &quot;num_reviews&quot;: 23, &quot;publisher&quot;: &quot;manning&quot; }
</code></pre>
<h2 id="例子">例子</h2>
<h3 id="1基本比对查询">1.基本比对查询</h3>
<p>执行基本的全文本（匹配）查询有两种方式：使用Search Lite API（它希望所有搜索参数都作为URL的一部分传入），或使用完整的JSON请求正文（允许您使用完整的Elasticsearch DSL)。</p>
<p>这是一个基本的匹配查询，它在所有字段中搜索字符串“ guide”</p>
<pre><code class="language-json">GET /bookdb_index/book/_search?q=guide

[Results]
&quot;hits&quot;: [
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;1&quot;,
        &quot;_score&quot;: 0.28168046,
        &quot;_source&quot;: {
          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;,
          &quot;authors&quot;: [
            &quot;clinton gormley&quot;,
            &quot;zachary tong&quot;
          ],
          &quot;summary&quot;: &quot;A distibuted real-time search and analytics engine&quot;,
          &quot;publish_date&quot;: &quot;2015-02-07&quot;,
          &quot;num_reviews&quot;: 20,
          &quot;publisher&quot;: &quot;manning&quot;
        }
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;4&quot;,
        &quot;_score&quot;: 0.24144039,
        &quot;_source&quot;: {
          &quot;title&quot;: &quot;Solr in Action&quot;,
          &quot;authors&quot;: [
            &quot;trey grainger&quot;,
            &quot;timothy potter&quot;
          ],
          &quot;summary&quot;: &quot;Comprehensive guide to implementing a scalable search engine using Apache Solr&quot;,
          &quot;publish_date&quot;: &quot;2014-04-05&quot;,
          &quot;num_reviews&quot;: 23,
          &quot;publisher&quot;: &quot;manning&quot;
        }
      }
    ]

</code></pre>
<p>该查询的完整版本如下所示，其产生的结果与上述搜索精简版相同。</p>
<pre><code class="language-java">{
    &quot;query&quot;: {
        &quot;multi_match&quot; : {
            &quot;query&quot; : &quot;guide&quot;,
            &quot;fields&quot; : [&quot;_all&quot;]
        }
    }
}
 
</code></pre>
<p>使用<code>multi_match</code>关键字代替关键字<code>match</code>是对多个字段运行相同查询的便捷快捷方式。该<code>fields</code>属性指定要查询的字段，在这种情况下，我们要查询文档中的所有字段。<br>
这两个API均允许您指定要搜索的字段。例如，要在标题字段中搜索带有“in action”字样的图书，请执行以下操作：</p>
<pre><code class="language-java">GET /bookdb_index/book/_search?q=title:in action

[Results]
&quot;hits&quot;: [
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;4&quot;,
        &quot;_score&quot;: 0.6259885,
        &quot;_source&quot;: {
          &quot;title&quot;: &quot;Solr in Action&quot;,
          &quot;authors&quot;: [
            &quot;trey grainger&quot;,
            &quot;timothy potter&quot;
          ],
          &quot;summary&quot;: &quot;Comprehensive guide to implementing a scalable search engine using Apache Solr&quot;,
          &quot;publish_date&quot;: &quot;2014-04-05&quot;,
          &quot;num_reviews&quot;: 23,
          &quot;publisher&quot;: &quot;manning&quot;
        }
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;3&quot;,
        &quot;_score&quot;: 0.5975345,
        &quot;_source&quot;: {
          &quot;title&quot;: &quot;Elasticsearch in Action&quot;,
          &quot;authors&quot;: [
            &quot;radu gheorge&quot;,
            &quot;matthew lee hinman&quot;,
            &quot;roy russo&quot;
          ],
          &quot;summary&quot;: &quot;build scalable search applications using Elasticsearch without having to do complex low-level programming or understand advanced data science algorithms&quot;,
          &quot;publish_date&quot;: &quot;2015-12-03&quot;,
          &quot;num_reviews&quot;: 18,
          &quot;publisher&quot;: &quot;manning&quot;
        }
      }
    ]
 
</code></pre>
<p>但是，全身DSL在创建更复杂的查询（如我们将在后面看到）以及指定您希望如何返回结果方面给您更大的灵活性。在下面的示例中，我们指定要返回的结果数，开始的偏移量（用于分页），要返回的文档字段以及术语突出显示。</p>
<pre><code class="language-java">POST /bookdb_index/book/_search
{
    &quot;query&quot;: {
        &quot;match&quot; : {
            &quot;title&quot; : &quot;in action&quot;
        }
    },
    &quot;size&quot;: 2,
    &quot;from&quot;: 0,
    &quot;_source&quot;: [ &quot;title&quot;, &quot;summary&quot;, &quot;publish_date&quot; ],
    &quot;highlight&quot;: {
        &quot;fields&quot; : {
            &quot;title&quot; : {}
        }
    }
}

[Results]
&quot;hits&quot;: {
    &quot;total&quot;: 2,
    &quot;max_score&quot;: 0.9105287,
    &quot;hits&quot;: [
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;3&quot;,
        &quot;_score&quot;: 0.9105287,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;build scalable search applications using Elasticsearch without having to do complex low-level programming or understand advanced data science algorithms&quot;,
          &quot;title&quot;: &quot;Elasticsearch in Action&quot;,
          &quot;publish_date&quot;: &quot;2015-12-03&quot;
        },
        &quot;highlight&quot;: {
          &quot;title&quot;: [
            &quot;Elasticsearch &lt;em&gt;in&lt;/em&gt; &lt;em&gt;Action&lt;/em&gt;&quot;
          ]
        }
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;4&quot;,
        &quot;_score&quot;: 0.9105287,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;Comprehensive guide to implementing a scalable search engine using Apache Solr&quot;,
          &quot;title&quot;: &quot;Solr in Action&quot;,
          &quot;publish_date&quot;: &quot;2014-04-05&quot;
        },
        &quot;highlight&quot;: {
          &quot;title&quot;: [
            &quot;Solr &lt;em&gt;in&lt;/em&gt; &lt;em&gt;Action&lt;/em&gt;&quot;
          ]
        }
      }
    ]
  }
 
</code></pre>
<p><strong>注意</strong>：对于多字查询，该<code>match</code>查询使您可以指定是否使用<code>and</code>运算符而不是默认<code>or</code>运算符。您还可以指定<code>minimum_should_match</code>选项来调整返回结果的相关性。可以在<a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/match-multi-word.html">这里</a>找到详细信息。</p>
<h3 id="2多字段搜索">2.多字段搜索</h3>
<p>正如我们已经看到的，要在搜索中查询多个文档字段（例如，在标题和摘要中搜索相同的查询字符串），则可以使用该<code>multi_match</code>查询。</p>
<pre><code class="language-java">POST /bookdb_index/book/_search
{
    &quot;query&quot;: {
        &quot;multi_match&quot; : {
            &quot;query&quot; : &quot;elasticsearch guide&quot;,
            &quot;fields&quot;: [&quot;title&quot;, &quot;summary&quot;]
        }
    }
}

[Results]
&quot;hits&quot;: {
    &quot;total&quot;: 3,
    &quot;max_score&quot;: 0.9448582,
    &quot;hits&quot;: [
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;1&quot;,
        &quot;_score&quot;: 0.9448582,
        &quot;_source&quot;: {
          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;,
          &quot;authors&quot;: [
            &quot;clinton gormley&quot;,
            &quot;zachary tong&quot;
          ],
          &quot;summary&quot;: &quot;A distibuted real-time search and analytics engine&quot;,
          &quot;publish_date&quot;: &quot;2015-02-07&quot;,
          &quot;num_reviews&quot;: 20,
          &quot;publisher&quot;: &quot;manning&quot;
        }
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;3&quot;,
        &quot;_score&quot;: 0.17312013,
        &quot;_source&quot;: {
          &quot;title&quot;: &quot;Elasticsearch in Action&quot;,
          &quot;authors&quot;: [
            &quot;radu gheorge&quot;,
            &quot;matthew lee hinman&quot;,
            &quot;roy russo&quot;
          ],
          &quot;summary&quot;: &quot;build scalable search applications using Elasticsearch without having to do complex low-level programming or understand advanced data science algorithms&quot;,
          &quot;publish_date&quot;: &quot;2015-12-03&quot;,
          &quot;num_reviews&quot;: 18,
          &quot;publisher&quot;: &quot;manning&quot;
        }
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;4&quot;,
        &quot;_score&quot;: 0.14965448,
        &quot;_source&quot;: {
          &quot;title&quot;: &quot;Solr in Action&quot;,
          &quot;authors&quot;: [
            &quot;trey grainger&quot;,
            &quot;timothy potter&quot;
          ],
          &quot;summary&quot;: &quot;Comprehensive guide to implementing a scalable search engine using Apache Solr&quot;,
          &quot;publish_date&quot;: &quot;2014-04-05&quot;,
          &quot;num_reviews&quot;: 23,
          &quot;publisher&quot;: &quot;manning&quot;
        }
      }
    ]
  }
 
</code></pre>
<p>请注意，命中数字3相匹配，因为在摘要中找到了“指南”一词。</p>
<h3 id="3提高字段重要性">3.提高字段重要性</h3>
<p>由于我们正在多个字段中进行搜索，因此我们可能希望提高特定字段中的得分。在以下人为设计的示例中，我们将摘要字段的得分提高了3倍，以提高摘要字段的重要性，这反过来又会增加文档<code>_id 4</code>的相关性。</p>
<pre><code class="language-java">POST /bookdb_index/book/_search
{
    &quot;query&quot;: {
        &quot;multi_match&quot; : {
            &quot;query&quot; : &quot;elasticsearch guide&quot;,
            &quot;fields&quot;: [&quot;title&quot;, &quot;summary^3&quot;]
        }
    },
    &quot;_source&quot;: [&quot;title&quot;, &quot;summary&quot;, &quot;publish_date&quot;]
}

[Results]
&quot;hits&quot;: [
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;1&quot;,
        &quot;_score&quot;: 0.31495273,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;A distibuted real-time search and analytics engine&quot;,
          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;,
          &quot;publish_date&quot;: &quot;2015-02-07&quot;
        }
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;4&quot;,
        &quot;_score&quot;: 0.14965448,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;Comprehensive guide to implementing a scalable search engine using Apache Solr&quot;,
          &quot;title&quot;: &quot;Solr in Action&quot;,
          &quot;publish_date&quot;: &quot;2014-04-05&quot;
        }
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;3&quot;,
        &quot;_score&quot;: 0.13094766,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;build scalable search applications using Elasticsearch without having to do complex low-level programming or understand advanced data science algorithms&quot;,
          &quot;title&quot;: &quot;Elasticsearch in Action&quot;,
          &quot;publish_date&quot;: &quot;2015-12-03&quot;
        }
      }
    ]
 
</code></pre>
<p><strong>注意</strong> ：Boosting不仅仅意味着计算出的分数会乘以Boosting系数。实际应用的升压值经过归一化和一些内部优化。有关增强工作原理的更多信息，请参见 <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/query-time-boosting.html">Elasticsearch指南</a>。</p>
<h3 id="4布尔查询">4.布尔查询</h3>
<p>AND / OR / NOT运算符可用于微调我们的搜索查询，以提供更相关或更具体的结果。这是在搜索API中作为<code>bool</code>查询实现的。该<code>bool</code>查询接受一个<code>must</code>参数（等同于AND），一个<code>must_not</code>参数（等同于NOT）和一个<code>should</code>参数（等同于OR）。例如，如果我要搜索书名中带有“ Elasticsearch”或“ Solr”字样的书，则AND由“克林顿·戈姆利”（clinton gormley）创作，而不由“ radu gheorge”（radu gheorge）创作：</p>
<pre><code class="language-java">POST /bookdb_index/book/_search
{
    &quot;query&quot;: {
        &quot;bool&quot;: {
            &quot;must&quot;: {
                &quot;bool&quot; : { &quot;should&quot;: [
                      { &quot;match&quot;: { &quot;title&quot;: &quot;Elasticsearch&quot; }},
                      { &quot;match&quot;: { &quot;title&quot;: &quot;Solr&quot; }} ] }
            },
            &quot;must&quot;: { &quot;match&quot;: { &quot;authors&quot;: &quot;clinton gormely&quot; }},
            &quot;must_not&quot;: { &quot;match&quot;: {&quot;authors&quot;: &quot;radu gheorge&quot; }}
        }
    }
}

[Results]
&quot;hits&quot;: [
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;1&quot;,
        &quot;_score&quot;: 0.3672021,
        &quot;_source&quot;: {
          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;,
          &quot;authors&quot;: [
            &quot;clinton gormley&quot;,
            &quot;zachary tong&quot;
          ],
          &quot;summary&quot;: &quot;A distibuted real-time search and analytics engine&quot;,
          &quot;publish_date&quot;: &quot;2015-02-07&quot;,
          &quot;num_reviews&quot;: 20,
          &quot;publisher&quot;: &quot;oreilly&quot;
        }
      }
    ]
 
</code></pre>
<p><strong>注意</strong>：如您所见，布尔查询可以包装任何其他查询类型，包括其他布尔查询，以创建任意复杂或深度嵌套的查询。</p>
<h3 id="5模糊查询">5.模糊查询</h3>
<p>可以在“匹配”和“多匹配”查询中启用模糊匹配，以捕获拼写错误。模糊程度是根据距原始单词的Levenshtein距离指定的。</p>
<pre><code class="language-java">POST /bookdb_index/book/_search
{
    &quot;query&quot;: {
        &quot;multi_match&quot; : {
            &quot;query&quot; : &quot;comprihensiv guide&quot;,
            &quot;fields&quot;: [&quot;title&quot;, &quot;summary&quot;],
            &quot;fuzziness&quot;: &quot;AUTO&quot;
        }
    },
    &quot;_source&quot;: [&quot;title&quot;, &quot;summary&quot;, &quot;publish_date&quot;],
    &quot;size&quot;: 1
}

[Results]
&quot;hits&quot;: [
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;4&quot;,
        &quot;_score&quot;: 0.5961596,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;Comprehensive guide to implementing a scalable search engine using Apache Solr&quot;,
          &quot;title&quot;: &quot;Solr in Action&quot;,
          &quot;publish_date&quot;: &quot;2014-04-05&quot;
        }
      }
    ]
 
</code></pre>
<p><strong>注意</strong>：模糊度值<code>&quot;AUTO&quot;</code>等于指定<code>2</code>术语长度大于5时的值。但是，设置80％的人类拼写错误的编辑距离为<code>1</code>，并将模糊度设置为<code>1</code>可以改善整体搜索性能。有关更多信息，请参见《Elasticsearch最终指南》的“<a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/fuzziness.html">错别字和拼写错误”</a>一章。</p>
<h3 id="6通配符查询">6.通配符查询</h3>
<p>通配符查询使您可以指定要匹配的模式，而不是整个术语。<code>?</code>匹配任何字符并<code>*</code>匹配零个或多个字符。例如，要查找所有作者姓名以字母“ t”开头的记录</p>
<pre><code class="language-java">POST /bookdb_index/book/_search
{
    &quot;query&quot;: {
        &quot;wildcard&quot; : {
            &quot;authors&quot; : &quot;t*&quot;
        }
    },
    &quot;_source&quot;: [&quot;title&quot;, &quot;authors&quot;],
    &quot;highlight&quot;: {
        &quot;fields&quot; : {
            &quot;authors&quot; : {}
        }
    }
}

[Results]
&quot;hits&quot;: [
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;1&quot;,
        &quot;_score&quot;: 1,
        &quot;_source&quot;: {
          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;,
          &quot;authors&quot;: [
            &quot;clinton gormley&quot;,
            &quot;zachary tong&quot;
          ]
        },
        &quot;highlight&quot;: {
          &quot;authors&quot;: [
            &quot;zachary &lt;em&gt;tong&lt;/em&gt;&quot;
          ]
        }
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;2&quot;,
        &quot;_score&quot;: 1,
        &quot;_source&quot;: {
          &quot;title&quot;: &quot;Taming Text: How to Find, Organize, and Manipulate It&quot;,
          &quot;authors&quot;: [
            &quot;grant ingersoll&quot;,
            &quot;thomas morton&quot;,
            &quot;drew farris&quot;
          ]
        },
        &quot;highlight&quot;: {
          &quot;authors&quot;: [
            &quot;&lt;em&gt;thomas&lt;/em&gt; morton&quot;
          ]
        }
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;4&quot;,
        &quot;_score&quot;: 1,
        &quot;_source&quot;: {
          &quot;title&quot;: &quot;Solr in Action&quot;,
          &quot;authors&quot;: [
            &quot;trey grainger&quot;,
            &quot;timothy potter&quot;
          ]
        },
        &quot;highlight&quot;: {
          &quot;authors&quot;: [
            &quot;&lt;em&gt;trey&lt;/em&gt; grainger&quot;,
            &quot;&lt;em&gt;timothy&lt;/em&gt; potter&quot;
          ]
        }
      }
    ] 
 
</code></pre>
<h3 id="7正则表达式查询">7.正则表达式查询</h3>
<p>正则表达式查询使您可以指定比通配符查询更复杂的模式。</p>
<pre><code class="language-java">POST /bookdb_index/book/_search
{
    &quot;query&quot;: {
        &quot;regexp&quot; : {
            &quot;authors&quot; : &quot;t[a-z]*y&quot;
        }
    },
    &quot;_source&quot;: [&quot;title&quot;, &quot;authors&quot;],
    &quot;highlight&quot;: {
        &quot;fields&quot; : {
            &quot;authors&quot; : {}
        }
    }
}

[Results]
&quot;hits&quot;: [
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;4&quot;,
        &quot;_score&quot;: 1,
        &quot;_source&quot;: {
          &quot;title&quot;: &quot;Solr in Action&quot;,
          &quot;authors&quot;: [
            &quot;trey grainger&quot;,
            &quot;timothy potter&quot;
          ]
        },
        &quot;highlight&quot;: {
          &quot;authors&quot;: [
            &quot;&lt;em&gt;trey&lt;/em&gt; grainger&quot;,
            &quot;&lt;em&gt;timothy&lt;/em&gt; potter&quot;
          ]
        }
      }
    ]
 
</code></pre>
<h3 id="8匹配词组查询">8.匹配词组查询</h3>
<p>匹配词组查询要求查询字符串中的所有术语都存在于文档中，并按照查询字符串中指定的顺序并且彼此接近。默认情况下，术语必须彼此完全平行，但是您可以指定一个<code>slop</code>值，该值指示在仍将文档视为匹配项时允许相隔多远的术语。</p>
<pre><code class="language-java">POST /bookdb_index/book/_search
{
    &quot;query&quot;: {
        &quot;multi_match&quot; : {
            &quot;query&quot;: &quot;search engine&quot;,
            &quot;fields&quot;: [&quot;title&quot;, &quot;summary&quot;],
            &quot;type&quot;: &quot;phrase&quot;,
            &quot;slop&quot;: 3
        }
    },
    &quot;_source&quot;: [ &quot;title&quot;, &quot;summary&quot;, &quot;publish_date&quot; ]
}

[Results]
&quot;hits&quot;: [
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;4&quot;,
        &quot;_score&quot;: 0.22327082,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;Comprehensive guide to implementing a scalable search engine using Apache Solr&quot;,
          &quot;title&quot;: &quot;Solr in Action&quot;,
          &quot;publish_date&quot;: &quot;2014-04-05&quot;
        }
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;1&quot;,
        &quot;_score&quot;: 0.16113183,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;A distibuted real-time search and analytics engine&quot;,
          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;,
          &quot;publish_date&quot;: &quot;2015-02-07&quot;
        }
      }
    ]
 
</code></pre>
<p><strong>注意</strong>：在上面的示例中，对于非短语类型查询，文档的<code>_id 1</code>得分通常更高，并且<code>_id 4</code>由于其字段长度较短而出现在文档的前面。但是，在进行短语查询时，会考虑到术语的接近度，因此文档<code>_id 4</code>得分会更高。</p>
<h3 id="9匹配词组前缀">9.匹配词组前缀</h3>
<p>匹配词组前缀查询可在查询时提供“按需输入”或“穷人”版本的自动完成功能，而无需以任何方式准备数据。像match_phrase查询一样，它接受一个<code>slop</code>参数以使单词顺序和相对位置的刚性降低一些。我还接受该<code>max_expansions</code>参数来限制匹配项的数量，以降低资源强度。</p>
<pre><code class="language-java">POST /bookdb_index/book/_search
{
    &quot;query&quot;: {
        &quot;match_phrase_prefix&quot; : {
            &quot;summary&quot;: {
                &quot;query&quot;: &quot;search en&quot;,
                &quot;slop&quot;: 3,
                &quot;max_expansions&quot;: 10
            }
        }
    },
    &quot;_source&quot;: [ &quot;title&quot;, &quot;summary&quot;, &quot;publish_date&quot; ]
}

[Results]
&quot;hits&quot;: [
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;4&quot;,
        &quot;_score&quot;: 0.5161346,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;Comprehensive guide to implementing a scalable search engine using Apache Solr&quot;,
          &quot;title&quot;: &quot;Solr in Action&quot;,
          &quot;publish_date&quot;: &quot;2014-04-05&quot;
        }
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;1&quot;,
        &quot;_score&quot;: 0.37248808,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;A distibuted real-time search and analytics engine&quot;,
          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;,
          &quot;publish_date&quot;: &quot;2015-02-07&quot;
        }
      }
    ]
 
</code></pre>
<p><strong>注意</strong>：“按类型查询时搜索”会降低性能。更好的解决方案是按类型进行索引时间搜索。请查看<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-suggesters-completion.html">完成提示API</a>或使用<a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/_index_time_search_as_you_type.html">Edge-Ngram过滤器</a>以获取更多信息。</p>
<h3 id="10请求参数">10.请求参数</h3>
<p>该<code>query_string</code>查询提供了一种以简洁的速记语法执行多重匹配查询，布尔查询，增强查询，模糊匹配，通配符，正则表达式和范围查询的方法。在下面的示例中，我们对术语“ saerch算法”执行模糊搜索，其中作者之一是“ grant ingersoll”或“ tom morton”。我们搜索所有字段，但对摘要字段加2。</p>
<pre><code class="language-java">POST /bookdb_index/book/_search
{
    &quot;query&quot;: {
        &quot;query_string&quot; : {
            &quot;query&quot;: &quot;(saerch~1 algorithm~1) AND (grant ingersoll)  OR (tom morton)&quot;,
            &quot;fields&quot;: [&quot;_all&quot;, &quot;summary^2&quot;]
        }
    },
    &quot;_source&quot;: [ &quot;title&quot;, &quot;summary&quot;, &quot;authors&quot; ],
    &quot;highlight&quot;: {
        &quot;fields&quot; : {
            &quot;summary&quot; : {}
        }
    }
}

[Results]
&quot;hits&quot;: [
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;2&quot;,
        &quot;_score&quot;: 0.14558059,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;organize text using approaches such as full-text search, proper name recognition, clustering, tagging, information extraction, and summarization&quot;,
          &quot;title&quot;: &quot;Taming Text: How to Find, Organize, and Manipulate It&quot;,
          &quot;authors&quot;: [
            &quot;grant ingersoll&quot;,
            &quot;thomas morton&quot;,
            &quot;drew farris&quot;
          ]
        },
        &quot;highlight&quot;: {
          &quot;summary&quot;: [
            &quot;organize text using approaches such as full-text &lt;em&gt;search&lt;/em&gt;, proper name recognition, clustering, tagging, information extraction, and summarization&quot;
          ]
        }
      }
    ]
 
</code></pre>
<h3 id="11简单查询字符串">11.简单查询字符串</h3>
<p>该<code>simple_query_string</code>查询是该查询的一种版本<code>query_string</code>，它更适合在暴露给用户的单个搜索框中使用。它分别用+ / | /-代替了AND / OR / NOT的使用，并且丢弃了查询的无效部分，而不是在用户犯错时抛出异常。</p>
<pre><code class="language-java">POST /bookdb_index/book/_search
{
    &quot;query&quot;: {
        &quot;simple_query_string&quot; : {
            &quot;query&quot;: &quot;(saerch~1 algorithm~1) + (grant ingersoll)  | (tom morton)&quot;,
            &quot;fields&quot;: [&quot;_all&quot;, &quot;summary^2&quot;]
        }
    },
    &quot;_source&quot;: [ &quot;title&quot;, &quot;summary&quot;, &quot;authors&quot; ],
    &quot;highlight&quot;: {
        &quot;fields&quot; : {
            &quot;summary&quot; : {}
        }
    }
} 
 
</code></pre>
<h3 id="12术语查询">12.术语查询</h3>
<p>以上示例是全文搜索的示例。有时，我们对结构化搜索更感兴趣，在结构化搜索中我们希望找到完全匹配并返回结果。在<code>term</code>与<code>terms</code>查询帮助我们在这里。在下面的示例中，我们正在搜索Manning Publications出版的索引中的所有书籍。</p>
<pre><code class="language-java">POST /bookdb_index/book/_search
{
    &quot;query&quot;: {
        &quot;term&quot; : {
            &quot;publisher&quot;: &quot;manning&quot;
        }
    },
    &quot;_source&quot; : [&quot;title&quot;,&quot;publish_date&quot;,&quot;publisher&quot;]
}

[Results]
&quot;hits&quot;: [
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;2&quot;,
        &quot;_score&quot;: 1.2231436,
        &quot;_source&quot;: {
          &quot;publisher&quot;: &quot;manning&quot;,
          &quot;title&quot;: &quot;Taming Text: How to Find, Organize, and Manipulate It&quot;,
          &quot;publish_date&quot;: &quot;2013-01-24&quot;
        }
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;3&quot;,
        &quot;_score&quot;: 1.2231436,
        &quot;_source&quot;: {
          &quot;publisher&quot;: &quot;manning&quot;,
          &quot;title&quot;: &quot;Elasticsearch in Action&quot;,
          &quot;publish_date&quot;: &quot;2015-12-03&quot;
        }
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;4&quot;,
        &quot;_score&quot;: 1.2231436,
        &quot;_source&quot;: {
          &quot;publisher&quot;: &quot;manning&quot;,
          &quot;title&quot;: &quot;Solr in Action&quot;,
          &quot;publish_date&quot;: &quot;2014-04-05&quot;
        }
      }
    ]
 
</code></pre>
<p>可以使用<code>terms</code>关键字代替并传递搜索词数组来指定多个词。</p>
<pre><code class="language-java">{
    &quot;query&quot;: {
        &quot;terms&quot; : {
            &quot;publisher&quot;: [&quot;oreilly&quot;, &quot;packt&quot;]
        }
    }
} 
 
</code></pre>
<h3 id="13字词查询-排序">13.字词查询-排序</h3>
<p>术语查询结果（与任何其他查询结果一样）可以轻松地进行排序。也允许多级排序</p>
<pre><code class="language-java">POST /bookdb_index/book/_search
{
    &quot;query&quot;: {
        &quot;term&quot; : {
            &quot;publisher&quot;: &quot;manning&quot;
        }
    },
    &quot;_source&quot; : [&quot;title&quot;,&quot;publish_date&quot;,&quot;publisher&quot;],
    &quot;sort&quot;: [
        { &quot;publish_date&quot;: {&quot;order&quot;:&quot;desc&quot;}},
        { &quot;title&quot;: { &quot;order&quot;: &quot;desc&quot; }}
    ]
}

[Results]
&quot;hits&quot;: [
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;3&quot;,
        &quot;_score&quot;: null,
        &quot;_source&quot;: {
          &quot;publisher&quot;: &quot;manning&quot;,
          &quot;title&quot;: &quot;Elasticsearch in Action&quot;,
          &quot;publish_date&quot;: &quot;2015-12-03&quot;
        },
        &quot;sort&quot;: [
          1449100800000,
          &quot;in&quot;
        ]
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;4&quot;,
        &quot;_score&quot;: null,
        &quot;_source&quot;: {
          &quot;publisher&quot;: &quot;manning&quot;,
          &quot;title&quot;: &quot;Solr in Action&quot;,
          &quot;publish_date&quot;: &quot;2014-04-05&quot;
        },
        &quot;sort&quot;: [
          1396656000000,
          &quot;solr&quot;
        ]
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;2&quot;,
        &quot;_score&quot;: null,
        &quot;_source&quot;: {
          &quot;publisher&quot;: &quot;manning&quot;,
          &quot;title&quot;: &quot;Taming Text: How to Find, Organize, and Manipulate It&quot;,
          &quot;publish_date&quot;: &quot;2013-01-24&quot;
        },
        &quot;sort&quot;: [
          1358985600000,
          &quot;to&quot;
        ]
      }
    ]
 
</code></pre>
<h3 id="14范围查询">14.范围查询</h3>
<p>另一个结构化查询示例是范围查询。在此示例中，我们搜索2015年出版的图书。</p>
<pre><code class="language-java">POST /bookdb_index/book/_search
{
    &quot;query&quot;: {
        &quot;range&quot; : {
            &quot;publish_date&quot;: {
                &quot;gte&quot;: &quot;2015-01-01&quot;,
                &quot;lte&quot;: &quot;2015-12-31&quot;
            }
        }
    },
    &quot;_source&quot; : [&quot;title&quot;,&quot;publish_date&quot;,&quot;publisher&quot;]
}

[Results]
&quot;hits&quot;: [
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;1&quot;,
        &quot;_score&quot;: 1,
        &quot;_source&quot;: {
          &quot;publisher&quot;: &quot;oreilly&quot;,
          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;,
          &quot;publish_date&quot;: &quot;2015-02-07&quot;
        }
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;3&quot;,
        &quot;_score&quot;: 1,
        &quot;_source&quot;: {
          &quot;publisher&quot;: &quot;manning&quot;,
          &quot;title&quot;: &quot;Elasticsearch in Action&quot;,
          &quot;publish_date&quot;: &quot;2015-12-03&quot;
        }
      }
    ]
 
</code></pre>
<p><strong>注意</strong>：范围查询适用于日期，数字和字符串类型字段。</p>
<h3 id="15过滤查询">15.过滤查询</h3>
<p>筛选查询允许您筛选查询结果。对于我们的示例，我们正在查询标题或摘要中带有“ Elasticsearch”一词的图书，但我们希望将搜索结果过滤为仅包含20条或更多评论的图书。</p>
<pre><code class="language-java">POST /bookdb_index/book/_search
{
    &quot;query&quot;: {
        &quot;filtered&quot;: {
            &quot;query&quot; : {
                &quot;multi_match&quot;: {
                    &quot;query&quot;: &quot;elasticsearch&quot;,
                    &quot;fields&quot;: [&quot;title&quot;,&quot;summary&quot;]
                }
            },
            &quot;filter&quot;: {
                &quot;range&quot; : {
                    &quot;num_reviews&quot;: {
                        &quot;gte&quot;: 20
                    }
                }
            }
        }
    },
    &quot;_source&quot; : [&quot;title&quot;,&quot;summary&quot;,&quot;publisher&quot;, &quot;num_reviews&quot;]
}

[Results]
&quot;hits&quot;: [
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;1&quot;,
        &quot;_score&quot;: 0.5955761,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;A distibuted real-time search and analytics engine&quot;,
          &quot;publisher&quot;: &quot;oreilly&quot;,
          &quot;num_reviews&quot;: 20,
          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;
        }
      }
    ]
 
</code></pre>
<p><strong>注意</strong>：筛选查询并不要求存在要对其进行筛选的查询。如果未指定<code>match_all</code>查询，则运行查询，该查询基本上返回索引中的所有文档，然后对其进行过滤。实际上，首先运行过滤器，以减少需要查询的表面积。此外，过滤器在首次使用后会被缓存，这使其性能非常好。</p>
<p><strong>更新</strong>：已过滤的查询已从即将推出的Elasticsearch 5.0中删除，以支持bool查询。这是与上面相同的示例，改写为使用bool查询。返回的结果完全相同。</p>
<pre><code class="language-java">POST /bookdb_index/book/_search
{
    &quot;query&quot;: {
        &quot;bool&quot;: {
            &quot;must&quot; : {
                &quot;multi_match&quot;: {
                    &quot;query&quot;: &quot;elasticsearch&quot;,
                    &quot;fields&quot;: [&quot;title&quot;,&quot;summary&quot;]
                }
            },
            &quot;filter&quot;: {
                &quot;range&quot; : {
                    &quot;num_reviews&quot;: {
                        &quot;gte&quot;: 20
                    }
                }
            }
        }
    },
    &quot;_source&quot; : [&quot;title&quot;,&quot;summary&quot;,&quot;publisher&quot;, &quot;num_reviews&quot;]
}
</code></pre>
<p>在下面的示例中，这也适用于多个过滤器。</p>
<h3 id="16多个过滤器">16.多个过滤器</h3>
<p>可以通过使用过滤器来组合多个过滤<code>bool</code>器。在下一个示例中，过滤器确定返回的结果必须至少具有20条评论，不得在2015年之前发布，而应由oreilly发布。</p>
<pre><code class="language-java">POST /bookdb_index/book/_search
{
    &quot;query&quot;: {
        &quot;filtered&quot;: {
            &quot;query&quot; : {
                &quot;multi_match&quot;: {
                    &quot;query&quot;: &quot;elasticsearch&quot;,
                    &quot;fields&quot;: [&quot;title&quot;,&quot;summary&quot;]
                }
            },
            &quot;filter&quot;: {
                &quot;bool&quot;: {
                    &quot;must&quot;: {
                        &quot;range&quot; : { &quot;num_reviews&quot;: { &quot;gte&quot;: 20 } }
                    },
                    &quot;must_not&quot;: {
                        &quot;range&quot; : { &quot;publish_date&quot;: { &quot;lte&quot;: &quot;2014-12-31&quot; } }
                    },
                    &quot;should&quot;: {
                        &quot;term&quot;: { &quot;publisher&quot;: &quot;oreilly&quot; }
                    }
                }
            }
        }
    },
    &quot;_source&quot; : [&quot;title&quot;,&quot;summary&quot;,&quot;publisher&quot;, &quot;num_reviews&quot;, &quot;publish_date&quot;]
}

[Results]
&quot;hits&quot;: [
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;1&quot;,
        &quot;_score&quot;: 0.5955761,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;A distibuted real-time search and analytics engine&quot;,
          &quot;publisher&quot;: &quot;oreilly&quot;,
          &quot;num_reviews&quot;: 20,
          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;,
          &quot;publish_date&quot;: &quot;2015-02-07&quot;
        }
      }
    ] 
 
</code></pre>
<h3 id="17功能评分字段值因子">17.功能评分：字段值因子</h3>
<p>在某些情况下，您可能希望将文档中特定字段的值纳入相关性分数的计算中。在您希望根据文档的受欢迎程度提高其相关性的情况下，这是典型的情况。在我们的示例中，我们希望增加受欢迎的书籍（根据评论数判断）。使用<code>field_value_factor</code>功能评分可以做到这一点。</p>
<pre><code class="language-java">POST /bookdb_index/book/_search
{
    &quot;query&quot;: {
        &quot;function_score&quot;: {
            &quot;query&quot;: {
                &quot;multi_match&quot; : {
                    &quot;query&quot; : &quot;search engine&quot;,
                    &quot;fields&quot;: [&quot;title&quot;, &quot;summary&quot;]
                }
            },
            &quot;field_value_factor&quot;: {
                &quot;field&quot; : &quot;num_reviews&quot;,
                &quot;modifier&quot;: &quot;log1p&quot;,
                &quot;factor&quot; : 2
            }
        }
    },
    &quot;_source&quot;: [&quot;title&quot;, &quot;summary&quot;, &quot;publish_date&quot;, &quot;num_reviews&quot;]
}

[Results]
&quot;hits&quot;: [
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;1&quot;,
        &quot;_score&quot;: 0.44831306,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;A distibuted real-time search and analytics engine&quot;,
          &quot;num_reviews&quot;: 20,
          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;,
          &quot;publish_date&quot;: &quot;2015-02-07&quot;
        }
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;4&quot;,
        &quot;_score&quot;: 0.3718407,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;Comprehensive guide to implementing a scalable search engine using Apache Solr&quot;,
          &quot;num_reviews&quot;: 23,
          &quot;title&quot;: &quot;Solr in Action&quot;,
          &quot;publish_date&quot;: &quot;2014-04-05&quot;
        }
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;3&quot;,
        &quot;_score&quot;: 0.046479136,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;build scalable search applications using Elasticsearch without having to do complex low-level programming or understand advanced data science algorithms&quot;,
          &quot;num_reviews&quot;: 18,
          &quot;title&quot;: &quot;Elasticsearch in Action&quot;,
          &quot;publish_date&quot;: &quot;2015-12-03&quot;
        }
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;2&quot;,
        &quot;_score&quot;: 0.041432835,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;organize text using approaches such as full-text search, proper name recognition, clustering, tagging, information extraction, and summarization&quot;,
          &quot;num_reviews&quot;: 12,
          &quot;title&quot;: &quot;Taming Text: How to Find, Organize, and Manipulate It&quot;,
          &quot;publish_date&quot;: &quot;2013-01-24&quot;
        }
      }
    ]
 
</code></pre>
<p><strong>注意1</strong>：我们本来可以运行常规<code>multi_match</code>查询并按num_reviews字段进行排序，但是这样就失去了进行相关性评分的好处。<br>
<strong>注意2</strong>：还有许多其他参数可以调整对原始相关性得分的增强效果，例如“修饰符”，“因子”，“ boost_mode”等。这些参数在<a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/boosting-by-popularity.html">Elasticsearch指南</a>中进行了详细探讨。</p>
<h3 id="18作用分值衰减功能">18.作用分值：衰减功能</h3>
<p>假设您不想以某个字段的值递增，而希望拥有理想的目标值，并且希望该增益因子随着距离该值的增加而衰减。这通常在基于纬度/经度，价格或日期等数字字段的提升中很有用。在我们精心设计的示例中，我们正在搜索理想情况下于2014年6月左右出版的“搜索引擎”书籍。</p>
<pre><code class="language-java">POST /bookdb_index/book/_search
{
    &quot;query&quot;: {
        &quot;function_score&quot;: {
            &quot;query&quot;: {
                &quot;multi_match&quot; : {
                    &quot;query&quot; : &quot;search engine&quot;,
                    &quot;fields&quot;: [&quot;title&quot;, &quot;summary&quot;]
                }
            },
            &quot;functions&quot;: [
                {
                    &quot;exp&quot;: {
                        &quot;publish_date&quot; : {
                            &quot;origin&quot;: &quot;2014-06-15&quot;,
                            &quot;offset&quot;: &quot;7d&quot;,
                            &quot;scale&quot; : &quot;30d&quot;
                        }
                    }
                }
            ],
            &quot;boost_mode&quot; : &quot;replace&quot;
        }
    },
    &quot;_source&quot;: [&quot;title&quot;, &quot;summary&quot;, &quot;publish_date&quot;, &quot;num_reviews&quot;]
}

[Results]
&quot;hits&quot;: [
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;4&quot;,
        &quot;_score&quot;: 0.27420625,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;Comprehensive guide to implementing a scalable search engine using Apache Solr&quot;,
          &quot;num_reviews&quot;: 23,
          &quot;title&quot;: &quot;Solr in Action&quot;,
          &quot;publish_date&quot;: &quot;2014-04-05&quot;
        }
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;1&quot;,
        &quot;_score&quot;: 0.005920768,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;A distibuted real-time search and analytics engine&quot;,
          &quot;num_reviews&quot;: 20,
          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;,
          &quot;publish_date&quot;: &quot;2015-02-07&quot;
        }
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;2&quot;,
        &quot;_score&quot;: 0.000011564,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;organize text using approaches such as full-text search, proper name recognition, clustering, tagging, information extraction, and summarization&quot;,
          &quot;num_reviews&quot;: 12,
          &quot;title&quot;: &quot;Taming Text: How to Find, Organize, and Manipulate It&quot;,
          &quot;publish_date&quot;: &quot;2013-01-24&quot;
        }
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;3&quot;,
        &quot;_score&quot;: 0.0000059171475,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;build scalable search applications using Elasticsearch without having to do complex low-level programming or understand advanced data science algorithms&quot;,
          &quot;num_reviews&quot;: 18,
          &quot;title&quot;: &quot;Elasticsearch in Action&quot;,
          &quot;publish_date&quot;: &quot;2015-12-03&quot;
        }
      }
    ]
 
</code></pre>
<h3 id="19功能评分脚本评分">19.功能评分：脚本评分</h3>
<p>如果内置的评分功能无法满足您的需求，则可以选择指定Groovy脚本进行评分。在我们的示例中，我们希望指定一个脚本，该脚本在决定要考虑评论数量的因素之前，先考虑publish_date。较新的书可能没有那么多的评论，因此不应因此受到惩罚。<br>
评分脚本如下所示：</p>
<pre><code class="language-java">publish_date = doc['publish_date'].value
num_reviews = doc['num_reviews'].value

if (publish_date &gt; Date.parse('yyyy-MM-dd', threshold).getTime()) {
  my_score = Math.log(2.5 + num_reviews)
} else {
  my_score = Math.log(1 + num_reviews)
}
return my_score
 
</code></pre>
<p>要动态使用评分脚本，我们使用<code>script_score</code>参数</p>
<pre><code class="language-java">POST /bookdb_index/book/_search
{
    &quot;query&quot;: {
        &quot;function_score&quot;: {
            &quot;query&quot;: {
                &quot;multi_match&quot; : {
                    &quot;query&quot; : &quot;search engine&quot;,
                    &quot;fields&quot;: [&quot;title&quot;, &quot;summary&quot;]
                }
            },
            &quot;functions&quot;: [
                {
                    &quot;script_score&quot;: {
                        &quot;params&quot; : {
                            &quot;threshold&quot;: &quot;2015-07-30&quot;
                        },
                        &quot;script&quot;: &quot;publish_date = doc['publish_date'].value; num_reviews = doc['num_reviews'].value; if (publish_date &gt; Date.parse('yyyy-MM-dd', threshold).getTime()) { return log(2.5 + num_reviews) }; return log(1 + num_reviews);&quot;
                    }
                }
            ]
        }
    },
    &quot;_source&quot;: [&quot;title&quot;, &quot;summary&quot;, &quot;publish_date&quot;, &quot;num_reviews&quot;]
}

[Results]
&quot;hits&quot;: {
    &quot;total&quot;: 4,
    &quot;max_score&quot;: 0.8463001,
    &quot;hits&quot;: [
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;1&quot;,
        &quot;_score&quot;: 0.8463001,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;A distibuted real-time search and analytics engine&quot;,
          &quot;num_reviews&quot;: 20,
          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;,
          &quot;publish_date&quot;: &quot;2015-02-07&quot;
        }
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;4&quot;,
        &quot;_score&quot;: 0.7067348,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;Comprehensive guide to implementing a scalable search engine using Apache Solr&quot;,
          &quot;num_reviews&quot;: 23,
          &quot;title&quot;: &quot;Solr in Action&quot;,
          &quot;publish_date&quot;: &quot;2014-04-05&quot;
        }
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;3&quot;,
        &quot;_score&quot;: 0.08952084,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;build scalable search applications using Elasticsearch without having to do complex low-level programming or understand advanced data science algorithms&quot;,
          &quot;num_reviews&quot;: 18,
          &quot;title&quot;: &quot;Elasticsearch in Action&quot;,
          &quot;publish_date&quot;: &quot;2015-12-03&quot;
        }
      },
      {
        &quot;_index&quot;: &quot;bookdb_index&quot;,
        &quot;_type&quot;: &quot;book&quot;,
        &quot;_id&quot;: &quot;2&quot;,
        &quot;_score&quot;: 0.07602123,
        &quot;_source&quot;: {
          &quot;summary&quot;: &quot;organize text using approaches such as full-text search, proper name recognition, clustering, tagging, information extraction, and summarization&quot;,
          &quot;num_reviews&quot;: 12,
          &quot;title&quot;: &quot;Taming Text: How to Find, Organize, and Manipulate It&quot;,
          &quot;publish_date&quot;: &quot;2013-01-24&quot;
        }
      }
    ]
  }
 
</code></pre>
<p><strong>注意1</strong>：要使用动态脚本，必须为<code>config/elasticsearch.yaml</code>文件中的Elasticsearch实例启用动态脚本。也可以使用存储在Elasticsearch服务器上的脚本。查阅<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-scripting.html">Elasticsearch参考文档</a>了解更多信息。</p>
<p><strong>注意2</strong> ：JSON无法包含嵌入的换行符，因此分号用于分隔语句。</p>

          <div class="toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E4%BE%8B%E5%AD%90">例子</a>
<ul>
<li><a href="#1%E5%9F%BA%E6%9C%AC%E6%AF%94%E5%AF%B9%E6%9F%A5%E8%AF%A2">1.基本比对查询</a></li>
<li><a href="#2%E5%A4%9A%E5%AD%97%E6%AE%B5%E6%90%9C%E7%B4%A2">2.多字段搜索</a></li>
<li><a href="#3%E6%8F%90%E9%AB%98%E5%AD%97%E6%AE%B5%E9%87%8D%E8%A6%81%E6%80%A7">3.提高字段重要性</a></li>
<li><a href="#4%E5%B8%83%E5%B0%94%E6%9F%A5%E8%AF%A2">4.布尔查询</a></li>
<li><a href="#5%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2">5.模糊查询</a></li>
<li><a href="#6%E9%80%9A%E9%85%8D%E7%AC%A6%E6%9F%A5%E8%AF%A2">6.通配符查询</a></li>
<li><a href="#7%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%9F%A5%E8%AF%A2">7.正则表达式查询</a></li>
<li><a href="#8%E5%8C%B9%E9%85%8D%E8%AF%8D%E7%BB%84%E6%9F%A5%E8%AF%A2">8.匹配词组查询</a></li>
<li><a href="#9%E5%8C%B9%E9%85%8D%E8%AF%8D%E7%BB%84%E5%89%8D%E7%BC%80">9.匹配词组前缀</a></li>
<li><a href="#10%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0">10.请求参数</a></li>
<li><a href="#11%E7%AE%80%E5%8D%95%E6%9F%A5%E8%AF%A2%E5%AD%97%E7%AC%A6%E4%B8%B2">11.简单查询字符串</a></li>
<li><a href="#12%E6%9C%AF%E8%AF%AD%E6%9F%A5%E8%AF%A2">12.术语查询</a></li>
<li><a href="#13%E5%AD%97%E8%AF%8D%E6%9F%A5%E8%AF%A2-%E6%8E%92%E5%BA%8F">13.字词查询-排序</a></li>
<li><a href="#14%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2">14.范围查询</a></li>
<li><a href="#15%E8%BF%87%E6%BB%A4%E6%9F%A5%E8%AF%A2">15.过滤查询</a></li>
<li><a href="#16%E5%A4%9A%E4%B8%AA%E8%BF%87%E6%BB%A4%E5%99%A8">16.多个过滤器</a></li>
<li><a href="#17%E5%8A%9F%E8%83%BD%E8%AF%84%E5%88%86%E5%AD%97%E6%AE%B5%E5%80%BC%E5%9B%A0%E5%AD%90">17.功能评分：字段值因子</a></li>
<li><a href="#18%E4%BD%9C%E7%94%A8%E5%88%86%E5%80%BC%E8%A1%B0%E5%87%8F%E5%8A%9F%E8%83%BD">18.作用分值：衰减功能</a></li>
<li><a href="#19%E5%8A%9F%E8%83%BD%E8%AF%84%E5%88%86%E8%84%9A%E6%9C%AC%E8%AF%84%E5%88%86">19.功能评分：脚本评分</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
          
              <hr />
            
          
            
            <p class="next-post">上一篇：
                <a href="https://tinaxiawuhao.github.io/post/3D5Sr6L0c/">
                  <span class="post-title">
                    docker安装ELK&rarr;
                  </span>
                </a>
              </p>
            
          
            
           <p class="prev-post">下一篇：
                 <a href="https://tinaxiawuhao.github.io/post/w_tIMVx00/">
                   <span class="post-title">
                     elasticSearch基础概念汇总&rarr;
                   </span>
                 </a>
               </p>
          
          <div class="comment" style="text-align: center;">
            

            
            
          </div>
        </div>
      </div>
  </article>
  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <ul class="list-inline text-center">
            
            
            <li class="list-inline-item">
              <a href="https://github.com/tinaxiawuhao" target="_blank">
                <span class="fa-stack fa-lg">
                  <i class="fas fa-circle fa-stack-2x"></i>
                  <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
            
              
            
              
            
              
            
              
            
              
            
              
            
              
              <!-- <li class="list-inline-item">
              <a href="https://tinaxiawuhao.github.io/atom.xml" target="_blank">
                <span class="fa-stack fa-lg">
                  <i class="fas fa-circle fa-stack-2x"></i>
                  <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
                </span>
              </a>
              </li> -->
          </ul>
          <p class="copyright text-muted">Copyright &copy;<span>tianxia</span><br><a href="https://github.com/getgridea/gridea" class="Themeinfo">Powered by Gridea</a></p>
        </div>
      </div>
    </div>
   </footer>
  <!-- Bootstrap core JavaScript -->
  <script src="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
  <!-- <script src="https://tinaxiawuhao.github.io/media/scripts/bootstrap.bundle.min.js"></script> -->
  <!-- Bootstrap core JavaScript -->
  <script src="https://cdn.jsdelivr.net/gh/Alanrk/clean-cdn@1.0/scripts/clean-blog.min.js"></script>
  <!-- <script src="https://tinaxiawuhao.github.io/media/scripts/clean-blog.min.js"></script> -->
  <style type="text/css">a.back_to_top{text-decoration:none;position:fixed;bottom:40px;right:30px;background:#f0f0f0;height:40px;width:40px;border-radius:50%;line-height:36px;font-size:18px;text-align:center;transition-duration:.5s;transition-propety:background-color;display:none}a.back_to_top span{color:#888}a.back_to_top:hover{cursor:pointer;background:#dfdfdf}a.back_to_top:hover span{color:#555}@media print,screen and(max-width:580px){.back_to_top{display:none!important}}</style>
<a id="back_to_top" href="#" class="back_to_top">
  <span>▲</span></a>
<script>$(document).ready((function(_this) {
    return function() {
      var bt;
      bt = $('#back_to_top');
      if ($(document).width() > 480) {
        $(window).scroll(function() {
          var st;
          st = $(window).scrollTop();
          if (st > 30) {
            return bt.css('display', 'block')
          } else {
            return bt.css('display', 'none')
          }
        });
        return bt.click(function() {
          $('body,html').animate({
            scrollTop: 0
          },
          800);
          return false
        })
      }
    }
  })(this));</script>
  
  <div id="landlord-parent">
    <div id="landlord">
        <div class="message" style="opacity:0"></div>
        <canvas id="live2d" width="240" height="250" class="live2d"></canvas>
    </div>
</div>

<script type="text/javascript">
    if (/(iPhone|iPad|iPod|iOS|Android)/i.test(navigator.userAgent)) {
        //移动端
        console.log("------ 移动端");
    } else {
        console.log("------ PC端 " + navigator.userAgent);

        addScript("https://cdn.jsdelivr.net/gh/850552586/ericamcdn@0.1/js/live2d.js", () => {
            // 加载完成后再loadlive2d
            loadlive2d("live2d", "https://tinaxiawuhao.github.io/media/live2d/assets/tororo.model.json");
        });

        var home_Path = "https://tinaxiawuhao.github.io/";
        addScript("https://tinaxiawuhao.github.io/media/live2d/js/message.js", () => { });
    }

    // 插入js文件，完成后callback
    function addScript(jsfile, callback) {
        var landlord_parent = document.getElementById("landlord-parent");
        var script = document.createElement("script");
        script.type = "text/javascript";
        script.src = jsfile;
        landlord_parent.appendChild(script);
        script.onload = script.onreadystatechange = function () {
            if (!this.readyState || this.readyState === "loaded" || this.readyState === "complete") {
                script.onload = script.onreadystatechange = null;
                if (callback && typeof callback == "function") {
                    callback(); //window[callback]();如果传递字符串过来 调用window['函数名']() 调用方法
                }
            }
        };
    }
</script>
  
  <script src="https://tinaxiawuhao.github.io/media/scripts/tocScript.js"></script>
</body>

</html>