<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<meta name="referrer" content="never">
<meta name="keywords" content="">
<meta name="description" content="欢迎访问[tianxia]的个人博客">
<meta name="author" content="kveln">
<title>Helm简介 | tianxia</title>
<link rel="stylesheet" href="https://tinaxiawuhao.github.io/resource/bootstrap.min.css">
<link href="https://tinaxiawuhao.github.io/resource/all.min.css" rel="stylesheet">
<link rel="alternate" type="application/rss+xml" title="Helm简介 | tianxia » Feed"
  href="http://localhost:4000/atom.xml">
<link rel="stylesheet"
  href="https://tinaxiawuhao.github.io/resource/androidstudio.min.css">
<link href="http://localhost:4000/styles/main.css" rel="stylesheet">
<script src="https://tinaxiawuhao.github.io/resource/jquery.min.js"></script>

<script src="https://tinaxiawuhao.github.io/resource/highlight.min.js"></script>

<link rel="stylesheet" href="https://tinaxiawuhao.github.io/resource/live2d.css">

<script>hljs.initHighlightingOnLoad();</script>

  <meta property="og:description" content="Helm简介" />
  <meta property="og:url" content="http://localhost:4000/post/zIWVYloAQ/" />
  <meta property="og:locale" content="zh-CN" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="tianxia" />
  <!-- <script src="../assets/styles/scripts/tocScript.js"></script> -->
</head>

<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="http://localhost:4000">tianxia</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
      data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
      aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        
        <li class="nav-item">
          
          <a class="nav-link" href="/">首页</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/archives">归档</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/tags">标签</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/post/about">关于</a>
          
        </li>
        
        <li class="nav-item">
          <div class="gridea-search-container">
            <form id="gridea-search-form" style="position: relative" data-update="1659699703857"
              action="/search/index.html">
              <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
              <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>
  <!-- Page Header -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="http://localhost:4000">tianxia</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
      data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
      aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        
        <li class="nav-item">
          
          <a class="nav-link" href="/">首页</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/archives">归档</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/tags">标签</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/post/about">关于</a>
          
        </li>
        
        <li class="nav-item">
          <div class="gridea-search-container">
            <form id="gridea-search-form" style="position: relative" data-update="1659699703857"
              action="/search/index.html">
              <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
              <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>
<header class="masthead" style="background-image: url('http://localhost:4000/media/images/home-bg.jpg')">
  <div class="overlay"></div>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        
          <!-- 没Title为其他页面Header -->
          
            <!-- 没Title并且有headerType为Post：文章Header -->
            <div class="post-heading">
              <span class="tags">
                
                <a href="http://localhost:4000/tag/f6exx1YLd/" class="tag">k8s</a>
                
              </span>
              <h1>Helm简介</h1>
              <span class="meta">
                Posted on
                2022-06-08，14 min read
              </span>
            </div>
          
        
      </div>
    </div>
  </div>
</header>
  <!-- Post Content -->
  <article id="post-content-article">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto post-content-container">
          
          <img class="post-feature-header-image" src="http://localhost:4000/post-images/zIWVYloAQ.png" alt="封面图">
          </img>
          
          <h3 id="一-简介">一、简介</h3>
<p>Helm是Kubernetes的包管理器。包管理器类似于Ubuntu中使用的apt、Python中的pip一样，能快速查找、下载和安装软件包。<br>
<strong>Helm解决的痛点</strong></p>
<ul>
<li>在Kubernetes中部署一个可以使用的应用，需要涉及到很多的Kubernetes资源的共同协作。比如安装一个WordPress，用到了一些Kubernetes的一些资源对象，包括Deployment用于部署应用、Service提供服务发现、Secret配置 WordPress的用户名和密码，可能还需要pv和pvc来提供持久化服务。并且WordPress数据是存储在mariadb里面的，所以需要mariadb启动就绪后才能启动 WordPress。这些k8s资源过于分散，不方便进行管理。</li>
<li>Helm把Kubernetes资源(比如deployments、services或ingress等) 打包到一个chart中，而chart被保存到chart仓库。通过chart仓库可用来存储和分享chart。Helm使发布可配置，支持发布应用配置的版本管理，简化了Kubernetes部署应用的版本控制、打包、发布、删除、更新等操作。</li>
</ul>
<p><strong>Helm相关组件及概念</strong></p>
<ul>
<li><strong>helm</strong>是一个命令行工具，主要用于Kubernetes应用程序Chart的创建、打包、发布以及创建和管理本地和远程的Chart仓库。chart Helm的软件包，采用TAR格式。类似于APT的DEB包或者YUM的RPM包，其包含了一组定义Kubernetes资源相关的 YAML文件。</li>
<li><strong>Repoistory</strong> Helm的软件仓库，Repository本质上是一个Web服务器，该服务器保存了一系列的Chart软件包以供用户下载，并且提供了一个该Repository的Chart包的清单文件以供查询。Helm可以同时管理多个不同的Repository。</li>
<li><strong>release</strong>使用helm install命令在Kubernetes集群中部署的Chart称为Release。可以理解为Helm使用Chart包部署的一个应用实例。</li>
</ul>
<blockquote>
<p>创建release<br>
helm 客户端从指定的目录或本地tar文件或远程repo仓库解析出chart的结构信息<br>
helm 客户端根据 chart 和 values 生成一个 release<br>
helm 将install release请求直接传递给 kube-apiserver</p>
<p>删除release<br>
helm 客户端从指定的目录或本地tar文件或远程repo仓库解析出chart的结构信息<br>
helm 客户端根据 chart 和 values 生成一个 release<br>
helm 将delete release请求直接传递给 kube-apiserver</p>
<p>更新release<br>
helm 客户端从指定的目录或本地tar文件或远程repo仓库解析出chart的结构信息<br>
helm 将收到的信息生成新的 release，并同时更新这个 release 的 history<br>
helm 将新的 release 传递给 kube-apiserver 进行更新</p>
</blockquote>
<ul>
<li>
<p><strong>chart</strong>的基本结构</p>
<pre><code class="language-java">## Helm的打包格式叫做chart，所谓chart就是一系列文件, 它描述了一组相关的 k8s 集群资源。
## Chart中的文件安装特定的目录结构组织, 最简单的chart 目录如下所示：
./
├── charts                            #  目录存放依赖的chart
├── Chart.yaml                        #  包含Chart的基本信息，包括chart版本，名称等
├── templates                         #  目录下存放应用一系列k8s资源的yaml模板
│   ├── deployment.yaml
│   ├── _helpers.tpl                  #  此文件中定义一些可重用的模板片断，此文件中的定义在任何资源定义模板中可用
│   ├── ingress.yaml
│   ├── NOTES.txt                     #  介绍chart部署后的帮助信息，如何使用chart等
│   ├── serviceaccount.yaml
│   ├── service.yaml
│   └── tests
│       └── test-connection.yaml
└── values.yaml                       #  包含了必要的值定义（默认值）, 用于存储templates目录中模板文件中用到变量的值
</code></pre>
</li>
</ul>
<h3 id="二-安装helm">二、安装Helm</h3>
<h4 id="1-安装helm">1 安装Helm</h4>
<pre><code class="language-shell">[root@Ansible01 ~]# wget https://get.helm.sh/helm-v3.8.2-linux-amd64.tar.gz
[root@Ansible01 ~]# tar -zxvf helm-v3.0.0-linux-amd64.tar.gz
[root@Ansible01 ~]# mv linux-amd64/helm /usr/local/bin/helm
[root@Ansible01 ~]# helm version
version.BuildInfo{Version:&quot;v3.8.2&quot;, GitCommit:&quot;6e3701edea09e5d55a8ca2aae03a68917630e91b&quot;, GitTreeState:&quot;clean&quot;, GoVersion:&quot;go1.17.5&quot;}
</code></pre>
<h4 id="2-添加常用repo">2 添加常用repo</h4>
<p><strong>添加存储库</strong></p>
<pre><code class="language-shell">[root@Ansible01 ~]# helm repo add aliyun https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts
&quot;aliyun&quot; has been added to your repositories
</code></pre>
<p><strong>更新存储库</strong></p>
<pre><code class="language-shell">[root@Ansible01 ~]# helm repo update
Hang tight while we grab the latest from your chart repositories...
...Successfully got an update from the &quot;aliyun&quot; chart repository
...Successfully got an update from the &quot;stable&quot; chart repository
...Successfully got an update from the &quot;prometheus-community&quot; chart repository
...Successfully got an update from the &quot;bitnami&quot; chart repository
Update Complete. ⎈Happy Helming!⎈
</code></pre>
<p><strong>查看存储库</strong></p>
<pre><code class="language-shell">[root@Ansible01 ~]# helm repo list
NAME                    URL                                                   
bitnami                 https://charts.bitnami.com/bitnami                    
prometheus-community    https://prometheus-community.github.io/helm-charts    
stable                  http://mirror.azure.cn/kubernetes/charts              
aliyun                  https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts
</code></pre>
<p><strong>删除存储库</strong></p>
<pre><code class="language-shell">[root@Ansible01 ~]# helm repo remove  aliyun
&quot;aliyun&quot; has been removed from your repositories
</code></pre>
<h3 id="三-使用helm">三、使用Helm</h3>
<h4 id="1-使用chart部署一个mysql">1 使用chart部署一个mysql</h4>
<pre><code class="language-shell">#  查找所有repo下的所有chart
helm search repo

#  查找stable这个repo下的chart mysql
helm search repo stable/mysql
 
#  查看chart信息：
helm show chart stable/mysql

 #  安装包：
helm install db stable/mysql**

# 查看发布状态：
helm status db
</code></pre>
<pre><code class="language-shell">[root@Ansible01 ~]# kubectl get pod -n default
NAME                        READY   STATUS    RESTARTS       AGE
db-mysql-599d764c8c-knfqc   0/1     Pending   0              2m10s
</code></pre>
<pre><code class="language-shell">[root@Ansible01 ~]# kubectl describe pod db-mysql-599d764c8c-knfqc -n default
......
Events:
  Type     Reason            Age                  From               Message
  ----     ------            ----                 ----               -------
  Warning  FailedScheduling  17s (x3 over 2m33s)  default-scheduler  0/4 nodes are available: 4 pod has unbound immediate PersistentVolumeClaims.
</code></pre>
<h4 id="2-安装前自定义chart配置选项">2 安装前自定义chart配置选项</h4>
<ul>
<li>上面部署的mysql并没有成功，这是因为并不是所有的chart都能按照默认配置运行成功，可能会需要一些环境依赖，例如PV。</li>
<li>所以需要自定义chart配置选项，安装过程中有两种方法可以传递配置数据：–values（或-f）：指定带有覆盖的YAML文件。这可以多次指定，最右边的文件优先。</li>
<li>–set：在命令行上指定替代。如果两者都用，–set优先级高</li>
</ul>
<p><strong>创建满足的PV</strong></p>
<pre><code class="language-shell">[root@Ansible01 mysql]# cat pv.yaml 
apiVersion: v1
kind: PersistentVolume
metadata:
  name: mysql-pv-volume
  labels:
    type: local
spec:
  storageClassName: &quot;managed-nfs-storage&quot;
  capacity:
    storage: 10Gi
  accessModes:
    - ReadWriteOnce
  hostPath:
    path: &quot;/mnt/data&quot;

[root@Ansible01 hello-world]# kubectl get pv
NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM                                           STORAGECLASS          REASON   AGE
mysql-pv-volume                            10Gi       RWO            Retain           Available                                                   managed-nfs-storage            4s
</code></pre>
<pre><code class="language-shell">[root@Ansible01 hello-world]# helm uninstall db
release &quot;db&quot; uninstalled

[root@Ansible01 hello-world]# cat config.yaml 
persistence:
  enabled: true
  storageClass: &quot;managed-nfs-storage&quot;
  accessMode: ReadWriteOnce
  size: 8Gi
mysqlUser: &quot;k8s&quot;
mysqlPassword: &quot;123456&quot;
mysqlDatabase: &quot;k8s&quot;

[root@Ansible01 hello-world]# helm install db -f config.yaml stable/mysql

[root@Ansible01 hello-world]# kubectl get pv
NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS     CLAIM                                           STORAGECLASS          REASON   AGE
mysql-pv-volume                            10Gi       RWO            Retain           Bound      default/db-mysql                                managed-nfs-storage            17s


[root@Ansible01 hello-world]# kubectl get pod 
NAME                       READY   STATUS    RESTARTS       AGE
db-mysql-f7fbfdd68-tc8cm   1/1     Running   0              11s
</code></pre>
<h4 id="3-构建一个helm-chart">3 构建一个Helm Chart</h4>
<ul>
<li>命令来创建一个名为mychart 的helm chart</li>
</ul>
<pre><code class="language-shell">[root@Ansible01 2022-05-21]# helm create mychart
Creating mychart
[root@Ansible01 2022-05-21]# ls
mychart
</code></pre>
<ul>
<li>创建后会在目录创建一个mychart目录</li>
</ul>
<pre><code class="language-shell">[root@Ansible01 2022-05-21]# tree mychart/
mychart/
├── charts
├── Chart.yaml
├── templates
│   ├── deployment.yaml
│   ├── _helpers.tpl
│   ├── hpa.yaml
│   ├── ingress.yaml
│   ├── NOTES.txt
│   ├── serviceaccount.yaml
│   ├── service.yaml
│   └── tests
│       └── test-connection.yaml
└── values.yaml

3 directories, 10 files
</code></pre>
<ul>
<li>其中mychart目录下的templates目录中保存有部署的模板文件，values.yaml中定义了部署的变量，Chart.yaml文件包含有version（chart版本）和appVersion（包含应用的版本）。</li>
</ul>
<pre><code class="language-shell">[root@Ansible01 2022-05-21]# cat mychart/Chart.yaml  |grep -v &quot;^#&quot; |grep -v ^$
apiVersion: v2
name: mychart
description: A Helm chart for Kubernetes
type: application
version: 0.1.0
appVersion: &quot;1.16.0&quot;
</code></pre>
<ul>
<li>选择镜像及标签和副本数（这里设置1个）</li>
</ul>
<pre><code class="language-shell">[root@Ansible01 2022-05-21]# vi mychart/values.yaml
replicaCount: 1

image:
  repository: myapp
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: &quot;v1&quot;
</code></pre>
<ul>
<li>编辑完成后检查依赖及模板配置是否正确</li>
</ul>
<pre><code class="language-shell">[root@Ansible01 2022-05-21]# cd mychart/
[root@Ansible01 mychart]# helm lint .
==&gt; Linting .
[INFO] Chart.yaml: icon is recommended

1 chart(s) linted, 0 chart(s) failed
</code></pre>
<ul>
<li>打包应用，其中0.1.0为在Chart.yaml文件中定义的version（chart版本）信息</li>
</ul>
<pre><code class="language-shell">[root@Ansible01 2022-05-21]# helm package mychart/
Successfully packaged chart and saved it to: /root/2022-05-21/mychart-0.1.0.tgz
[root@Ansible01 2022-05-21]# ls
mychart  mychart-0.1.0.tgz
</code></pre>
<ul>
<li>升级、回滚和删除</li>
</ul>
<pre><code class="language-shell">#  发布新版本的chart时，或者当您要更改发布的配置时，可以使用该helm upgrade 命令。
helm upgrade --set imageTag=1.17 web mychart
helm upgrade -f values.yaml web mychart
 
#  如果在发布后没有达到预期的效果，则可以使用helm rollback回滚到之前的版本。
例如将应用回滚到第一个版本：
helm rollback web 2

#  卸载发行版，请使用以下helm uninstall命令：
helm uninstall web

#  查看历史版本配置信息
helm get --revision 1 web
</code></pre>
<ul>
<li>下载、上传tar包</li>
</ul>
<pre><code class="language-shell">[root@Ansible01 2022-05-21]# helm pull stable/traefik
[root@Ansible01 2022-05-21]# ls
traefik-1.87.7.tgz
</code></pre>
<pre><code class="language-shell"># 　 一种方式是直接上传charts文件夹，seldon-mab是charts目录，harbor-test-helm是harbor charts repo名称。
helm push seldon-mab harbor-test-helm

#　　另一种是将charts package文件包push
helm push seldon-core-operator-1.5.1.tgz harbor-test-helm
</code></pre>
<ul>
<li>安装到k8s的其它空间：--namespace=monitoring</li>
</ul>
<pre><code class="language-shell">helm install --name prometheus-operator --set rbacEnable=true --namespace=monitoring stable/prometheus-operator
</code></pre>
<h3 id="四-helm使用minio搭建私有仓库">四、Helm使用minio搭建私有仓库</h3>
<p><strong>minio介绍</strong></p>
<p>我们一般是从本地的目录结构中的chart去进行部署，如果要集中管理chart,就需要涉及到repository的问题，因为helmrepository都是指到外面的地址，接下来我们可以通过minio建立一个企业私有的存放仓库。</p>
<p>Minio提供对象存储服务。它的应用场景被设定在了非结构化的数据的存储之上了。众所周知，非结构化对象诸如图像/音频/视频/log文件/系统备份/镜像文件…等等保存起来管理总是不那么方便，size变化很大，类型很多，再有云端的结合会使得情况更加复杂，minio就是解决此种场景的一个解决方案。Minio号称其能很好的适应非结构化的数据，支持AWS的S3，非结构化的文件从数KB到5TB都能很好的支持。</p>
<p>Minio的使用比较简单，只有两个文件，服务端minio,客户访问端mc,比较简单。</p>
<p>在项目中，我们可以直接找一台虚拟机作为Minio Server,提供服务，当然minio也支持作为Pod部署。</p>
<h4 id="1-helm3存储库更改">1 helm3存储库更改</h4>
<p>在Helm 2中，默认情况下包括稳定的图表存储库。在Helm 3中，默认情况下不包含任何存储库。因此需要做的第一件事就是添加一个存储库。官方图表存储库将在有限的时间内继续接收补丁，但是将不再作为默认存储库包含在Helm客户端中。</p>
<h4 id="2-minio介绍">2 minio介绍</h4>
<p>MinIO 是一个基于Apache License  v2.0开源协议的对象存储服务。它兼容亚马逊S3云存储服务接口，非常适合于存储大容量非结构化的数据，例如图片、视频、日志文件、备份数据和容器/虚拟机镜像等，而一个对象文件可以是任意大小，从几kb到最大5T不等。</p>
<p>MinIO是一个非常轻量的服务,可以很简单的和其他应用的结合，类似 NodeJS, Redis 或者 MySQL。</p>
<h4 id="3-安装minio服务端">3 安装minio服务端</h4>
<p><strong>1使用容器安装服务端</strong></p>
<pre><code class="language-shell">docker pull minio/minio
docker run -p 9000:9000 minio/minio server /data
</code></pre>
<p><strong>2使用二进制安装服务端</strong></p>
<pre><code class="language-shell">wget https://dl.min.io/server/minio/release/linux-amd64/minio
chmod +x minio
mkdir -p /chart
./minio server /chart
</code></pre>
<figure data-type="image" tabindex="1"><img src="http://localhost:4000/post-images/1657191641142.png" alt="" loading="lazy"></figure>
<p><strong>访问Browser Access地址：</strong></p>
<figure data-type="image" tabindex="2"><img src="http://localhost:4000/post-images/1657191649298.png" alt="" loading="lazy"></figure>
<p><strong>在启动日志中获取access  key和secret  key</strong></p>
<figure data-type="image" tabindex="3"><img src="http://localhost:4000/post-images/1657191656837.png" alt="" loading="lazy"></figure>
<p>看到这个页面则表示登陆成功</p>
<figure data-type="image" tabindex="4"><img src="http://localhost:4000/post-images/1657191664579.png" alt="" loading="lazy"></figure>
<p>至此服务端部署完成。</p>
<h4 id="4-安装minio客户端">4 安装minio客户端</h4>
<p><strong>1.使用容器安装客户端</strong></p>
<pre><code class="language-shell">docker pull minio/mc
docker run minio/mc ls play
</code></pre>
<p><strong>2.使用二进制安装客户端</strong></p>
<pre><code class="language-shell">wget https://dl.min.io/client/mc/release/linux-amd64/mc
chmod +x mc
./mc
</code></pre>
<figure data-type="image" tabindex="5"><img src="http://localhost:4000/post-images/1657191674247.png" alt="" loading="lazy"></figure>
<h4 id="5-连接至服务端">5 连接至服务端</h4>
<pre><code class="language-shell">./mc config host add myminio http://172.17.0.1:9000 XH2LCA4AJIP52RDB4P5M CDDCuoS2FNsdW8S0bodkcs2729N+TH5lFov+rrT3
</code></pre>
<figure data-type="image" tabindex="6"><img src="http://localhost:4000/post-images/1657191689882.png" alt="" loading="lazy"></figure>
<p>服务端启动时候的access  key和secret  key</p>
<h4 id="6-mc的shell使用别名">6 mc的shell使用别名</h4>
<pre><code class="language-shell">ls=mc ls
cp=mc cp
cat=mc cat
mkdir=mc mb
pipe=mc pipe
find=mc find
</code></pre>
<h4 id="7-创建bucket">7 创建bucket</h4>
<pre><code class="language-shell">./mc mb myminio/minio-helm-repo
</code></pre>
<figure data-type="image" tabindex="7"><img src="http://localhost:4000/post-images/1657191697994.png" alt="" loading="lazy"></figure>
<h4 id="8-设置bucket和objects匿名访问">8 设置bucket和objects匿名访问</h4>
<pre><code class="language-shell">./mc policy set download myminio/minio-helm-repo
</code></pre>
<figure data-type="image" tabindex="8"><img src="http://localhost:4000/post-images/1657191704821.png" alt="" loading="lazy"></figure>
<h4 id="9-helm创建与仓库连接的indexyaml文件">9 helm创建与仓库连接的index.yaml文件</h4>
<pre><code class="language-shell">mkdir /root/helm/repo
helm repo index helm/repo/
</code></pre>
<h4 id="10-helm与minio仓库进行连接">10 helm与minio仓库进行连接</h4>
<p><strong>1.将index.yaml文件推送到backet中去</strong></p>
<pre><code class="language-shell">./mc cp helm/repo/index.yaml myminio/minio-helm-repo
</code></pre>
<figure data-type="image" tabindex="9"><img src="http://localhost:4000/post-images/1657191712580.png" alt="" loading="lazy"></figure>
<p><strong>2.helm连接私仓</strong></p>
<pre><code class="language-shell">helm repo add fengnan http://192.168.0.119:9000/minio-helm-repo
</code></pre>
<figure data-type="image" tabindex="10"><img src="http://localhost:4000/post-images/1657191720766.png" alt="" loading="lazy"></figure>
<p><strong>3.更新repo仓库</strong></p>
<pre><code class="language-shell">helm repo update
</code></pre>
<figure data-type="image" tabindex="11"><img src="http://localhost:4000/post-images/1657191729687.png" alt="" loading="lazy"></figure>
<p><strong>4.查看repo</strong></p>
<pre><code class="language-shell">helm repo list
</code></pre>
<figure data-type="image" tabindex="12"><img src="http://localhost:4000/post-images/1657191738239.png" alt="" loading="lazy"></figure>
<p><strong>5.查看repo中的文件</strong></p>
<pre><code class="language-shell">./mc ls myminio/minio-helm-repo
</code></pre>
<figure data-type="image" tabindex="13"><img src="http://localhost:4000/post-images/1657191745072.png" alt="" loading="lazy"></figure>
<p><strong>6.登录服务端web界面查看</strong></p>
<figure data-type="image" tabindex="14"><img src="http://localhost:4000/post-images/1657191757447.png" alt="" loading="lazy"></figure>

          <div class="toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li>
<ul>
<li><a href="#%E4%B8%80-%E7%AE%80%E4%BB%8B">一、简介</a></li>
<li><a href="#%E4%BA%8C-%E5%AE%89%E8%A3%85helm">二、安装Helm</a>
<ul>
<li><a href="#1-%E5%AE%89%E8%A3%85helm">1 安装Helm</a></li>
<li><a href="#2-%E6%B7%BB%E5%8A%A0%E5%B8%B8%E7%94%A8repo">2 添加常用repo</a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E4%BD%BF%E7%94%A8helm">三、使用Helm</a>
<ul>
<li><a href="#1-%E4%BD%BF%E7%94%A8chart%E9%83%A8%E7%BD%B2%E4%B8%80%E4%B8%AAmysql">1 使用chart部署一个mysql</a></li>
<li><a href="#2-%E5%AE%89%E8%A3%85%E5%89%8D%E8%87%AA%E5%AE%9A%E4%B9%89chart%E9%85%8D%E7%BD%AE%E9%80%89%E9%A1%B9">2 安装前自定义chart配置选项</a></li>
<li><a href="#3-%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AAhelm-chart">3 构建一个Helm Chart</a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-helm%E4%BD%BF%E7%94%A8minio%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93">四、Helm使用minio搭建私有仓库</a>
<ul>
<li><a href="#1-helm3%E5%AD%98%E5%82%A8%E5%BA%93%E6%9B%B4%E6%94%B9">1 helm3存储库更改</a></li>
<li><a href="#2-minio%E4%BB%8B%E7%BB%8D">2 minio介绍</a></li>
<li><a href="#3-%E5%AE%89%E8%A3%85minio%E6%9C%8D%E5%8A%A1%E7%AB%AF">3 安装minio服务端</a></li>
<li><a href="#4-%E5%AE%89%E8%A3%85minio%E5%AE%A2%E6%88%B7%E7%AB%AF">4 安装minio客户端</a></li>
<li><a href="#5-%E8%BF%9E%E6%8E%A5%E8%87%B3%E6%9C%8D%E5%8A%A1%E7%AB%AF">5 连接至服务端</a></li>
<li><a href="#6-mc%E7%9A%84shell%E4%BD%BF%E7%94%A8%E5%88%AB%E5%90%8D">6 mc的shell使用别名</a></li>
<li><a href="#7-%E5%88%9B%E5%BB%BAbucket">7 创建bucket</a></li>
<li><a href="#8-%E8%AE%BE%E7%BD%AEbucket%E5%92%8Cobjects%E5%8C%BF%E5%90%8D%E8%AE%BF%E9%97%AE">8 设置bucket和objects匿名访问</a></li>
<li><a href="#9-helm%E5%88%9B%E5%BB%BA%E4%B8%8E%E4%BB%93%E5%BA%93%E8%BF%9E%E6%8E%A5%E7%9A%84indexyaml%E6%96%87%E4%BB%B6">9 helm创建与仓库连接的index.yaml文件</a></li>
<li><a href="#10-helm%E4%B8%8Eminio%E4%BB%93%E5%BA%93%E8%BF%9B%E8%A1%8C%E8%BF%9E%E6%8E%A5">10 helm与minio仓库进行连接</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
          
              <hr />
            
          
            
            <p class="next-post">上一篇：
                <a href="http://localhost:4000/post/HhauOMn26/">
                  <span class="post-title">
                    k8s资源操作&rarr;
                  </span>
                </a>
              </p>
            
          
            
           <p class="prev-post">下一篇：
                 <a href="http://localhost:4000/post/McgbXRFnx/">
                   <span class="post-title">
                     k8s高可用集群搭建&rarr;
                   </span>
                 </a>
               </p>
          
          <div class="comment" style="text-align: center;">
            

            
            
          </div>
        </div>
      </div>
  </article>
  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <ul class="list-inline text-center">
            
            
            <li class="list-inline-item">
              <a href="https://github.com/tinaxiawuhao" target="_blank">
                <span class="fa-stack fa-lg">
                  <i class="fas fa-circle fa-stack-2x"></i>
                  <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
            
              
            
              
            
              
            
              
            
              
            
              
            
              
              <!-- <li class="list-inline-item">
              <a href="http://localhost:4000/atom.xml" target="_blank">
                <span class="fa-stack fa-lg">
                  <i class="fas fa-circle fa-stack-2x"></i>
                  <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
                </span>
              </a>
              </li> -->
          </ul>
          <p class="copyright text-muted">Copyright &copy;<span>tianxia</span><br><a href="https://github.com/getgridea/gridea" class="Themeinfo">Powered by Gridea</a></p>
        </div>
      </div>
    </div>
   </footer>
  <!-- Bootstrap core JavaScript -->
  <script src="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
  <!-- <script src="http://localhost:4000/media/scripts/bootstrap.bundle.min.js"></script> -->
  <!-- Bootstrap core JavaScript -->
  <script src="https://cdn.jsdelivr.net/gh/Alanrk/clean-cdn@1.0/scripts/clean-blog.min.js"></script>
  <!-- <script src="http://localhost:4000/media/scripts/clean-blog.min.js"></script> -->
  <style type="text/css">a.back_to_top{text-decoration:none;position:fixed;bottom:40px;right:30px;background:#f0f0f0;height:40px;width:40px;border-radius:50%;line-height:36px;font-size:18px;text-align:center;transition-duration:.5s;transition-propety:background-color;display:none}a.back_to_top span{color:#888}a.back_to_top:hover{cursor:pointer;background:#dfdfdf}a.back_to_top:hover span{color:#555}@media print,screen and(max-width:580px){.back_to_top{display:none!important}}</style>
<a id="back_to_top" href="#" class="back_to_top">
  <span>▲</span></a>
<script>$(document).ready((function(_this) {
    return function() {
      var bt;
      bt = $('#back_to_top');
      if ($(document).width() > 480) {
        $(window).scroll(function() {
          var st;
          st = $(window).scrollTop();
          if (st > 30) {
            return bt.css('display', 'block')
          } else {
            return bt.css('display', 'none')
          }
        });
        return bt.click(function() {
          $('body,html').animate({
            scrollTop: 0
          },
          800);
          return false
        })
      }
    }
  })(this));</script>
  
  <div id="landlord-parent">
    <div id="landlord">
        <div class="message" style="opacity:0"></div>
        <canvas id="live2d" width="240" height="250" class="live2d"></canvas>
    </div>
</div>

<script type="text/javascript">
    if (/(iPhone|iPad|iPod|iOS|Android)/i.test(navigator.userAgent)) {
        //移动端
        console.log("------ 移动端");
    } else {
        console.log("------ PC端 " + navigator.userAgent);

        addScript("https://cdn.jsdelivr.net/gh/850552586/ericamcdn@0.1/js/live2d.js", () => {
            // 加载完成后再loadlive2d
            loadlive2d("live2d", "http://localhost:4000/media/live2d/assets/tororo.model.json");
        });

        var home_Path = "http://localhost:4000/";
        addScript("http://localhost:4000/media/live2d/js/message.js", () => { });
    }

    // 插入js文件，完成后callback
    function addScript(jsfile, callback) {
        var landlord_parent = document.getElementById("landlord-parent");
        var script = document.createElement("script");
        script.type = "text/javascript";
        script.src = jsfile;
        landlord_parent.appendChild(script);
        script.onload = script.onreadystatechange = function () {
            if (!this.readyState || this.readyState === "loaded" || this.readyState === "complete") {
                script.onload = script.onreadystatechange = null;
                if (callback && typeof callback == "function") {
                    callback(); //window[callback]();如果传递字符串过来 调用window['函数名']() 调用方法
                }
            }
        };
    }
</script>
  
  <script src="http://localhost:4000/media/scripts/tocScript.js"></script>
</body>

</html>