<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<meta name="referrer" content="never">
<meta name="keywords" content="">
<meta name="description" content="欢迎访问[tianxia]的个人博客">
<meta name="author" content="kveln">
<title>gradle详情 | tianxia</title>
<link rel="stylesheet" href="https://tinaxiawuhao.github.io/resource/bootstrap.min.css">
<link href="https://tinaxiawuhao.github.io/resource/all.min.css" rel="stylesheet">
<link rel="alternate" type="application/rss+xml" title="gradle详情 | tianxia » Feed"
  href="https://tinaxiawuhao.github.io/atom.xml">
<link rel="stylesheet"
  href="https://tinaxiawuhao.github.io/resource/androidstudio.min.css">
<link href="https://tinaxiawuhao.github.io/styles/main.css" rel="stylesheet">
<script src="https://tinaxiawuhao.github.io/resource/jquery.min.js"></script>

<script src="https://tinaxiawuhao.github.io/resource/highlight.min.js"></script>

<link rel="stylesheet" href="https://tinaxiawuhao.github.io/resource/live2d.css">

<script>hljs.initHighlightingOnLoad();</script>

  <meta property="og:description" content="gradle详情" />
  <meta property="og:url" content="https://tinaxiawuhao.github.io/post/29jyrX-eN/" />
  <meta property="og:locale" content="zh-CN" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="tianxia" />
  <!-- <script src="../assets/styles/scripts/tocScript.js"></script> -->
</head>

<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="https://tinaxiawuhao.github.io">tianxia</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
      data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
      aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        
        <li class="nav-item">
          
          <a class="nav-link" href="/">首页</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/archives">归档</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/tags">标签</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/post/about">关于</a>
          
        </li>
        
        <li class="nav-item">
          <div class="gridea-search-container">
            <form id="gridea-search-form" style="position: relative" data-update="1659012644247"
              action="/search/index.html">
              <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
              <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>
  <!-- Page Header -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="https://tinaxiawuhao.github.io">tianxia</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
      data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
      aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        
        <li class="nav-item">
          
          <a class="nav-link" href="/">首页</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/archives">归档</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/tags">标签</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/post/about">关于</a>
          
        </li>
        
        <li class="nav-item">
          <div class="gridea-search-container">
            <form id="gridea-search-form" style="position: relative" data-update="1659012644247"
              action="/search/index.html">
              <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
              <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>
<header class="masthead" style="background-image: url('https://tinaxiawuhao.github.io/media/images/home-bg.jpg')">
  <div class="overlay"></div>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        
          <!-- 没Title为其他页面Header -->
          
            <!-- 没Title并且有headerType为Post：文章Header -->
            <div class="post-heading">
              <span class="tags">
                
                <a href="https://tinaxiawuhao.github.io/tag/_whMOC5wx/" class="tag">gradle</a>
                
              </span>
              <h1>gradle详情</h1>
              <span class="meta">
                Posted on
                2021-07-01，17 min read
              </span>
            </div>
          
        
      </div>
    </div>
  </div>
</header>
  <!-- Post Content -->
  <article id="post-content-article">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto post-content-container">
          
          <img class="post-feature-header-image" src="https://tinaxiawuhao.github.io/post-images/29jyrX-eN.png" alt="封面图">
          </img>
          
          <h3 id="一-依赖管理">一 依赖管理</h3>
<p>implementation:会将指定的依赖添加到编译路径，并且会将该依赖打包到输出，但是这个依赖在编译时不能暴露给其他模块，例如依赖此模块的其他模块。这种方式指定的依赖在编译时只能在当前模块中访问。</p>
<p>api:使用api配置的依赖会将对应的依赖添加到编译路径，并将依赖打包输出，但是这个依赖是可以传递的，比如模块A依赖模块B，B依赖库C，模块B在编译时能够访问到库C，但是与implemetation不同的是，在模块A中库C也是可以访问的。</p>
<p>compileOnly:compileOnly修饰的依赖会添加到编译路径中，但是不会打包，因此只能在编译时访问，且compileOnly修饰的依赖不会传递。</p>
<p>runtimeOnly:这个与compileOnly相反，它修饰的依赖不会添加到编译路径中，但是被打包，运行时使用。没有使用过。</p>
<p>annotationProcessor:用于注解处理器的依赖配置</p>
<pre><code class="language-java">dependencies {
    // 本地项目
    api project(':com.test.core:core-common')  
    //外部依赖
    implementation 'org.springframework.boot:spring-boot-starter'
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
}
</code></pre>
<h3 id="二-仓库">二 仓库</h3>
<p><strong>远程仓库</strong><br>
使用Maven中央仓库，maven仓库的URL为：<a href="https://links.jianshu.com/go?to=http%3A%2F%2Frepo1.maven.org%2Fmaven2%2F">http://repo1.maven.org/maven2/</a></p>
<pre><code class="language-java">repositories {
    mavenCentral()
}
</code></pre>
<p>使用Maven远程仓库</p>
<pre><code class="language-java">repositories {
    //阿里云远程仓库
    maven { url 'https://maven.aliyun.com/repository/central'}
	maven { url 'https://maven.aliyun.com/repository/public' }
    mavenCentral()
}
</code></pre>
<p><strong>本地仓库</strong><br>
配置Gradle使用maven本地仓库：<code>CRADLE_USER_HOME：D:.m2\repository</code></p>
<figure data-type="image" tabindex="1"><img src="https://tinaxiawuhao.github.io/post-images/1657022747903.png" alt="img" loading="lazy"></figure>
<p>修改配置build.gradle：</p>
<pre><code class="language-java">/**
 * 指定所使用的仓库，mavenCentral()表示使用中央仓库，
 * 此刻项目中所需要的jar包都会默认从中央仓库下载到本地指定目录
 * 配置mavenLocal()表示引入jar包的时候，先从本地仓库中找，没有再去中央仓库下载
 */
repositories {
    mavenLocal()
    mavenCentral()
}
</code></pre>
<p><strong>修改或者添加额外的私有仓库地址</strong><br>
直接修改 settings.gradle 来添加其它仓库：</p>
<pre><code class="language-java">// settings.gradle
//pluginManagement {}块只能出现在settings.gradle文件中，必须是文件中的第一个块，也可以以settings形式出现在初始化脚本中。
pluginManagement {
    repositories {
		maven { url 'https://maven.aliyun.com/repository/central'}
		maven { url 'https://maven.aliyun.com/repository/public' }
		mavenCentral()
		gradlePluginPortal()
		maven {
			url 'https://repo.spring.io/release'
		}
		if (version.endsWith('-SNAPSHOT')) {
			maven { url &quot;https://repo.spring.io/snapshot&quot; }
		}
	}
}
</code></pre>
<h3 id="三-多项目构建">三 多项目构建</h3>
<p>多项目构成：allProjects = root项目+各子项目<br>
settings文件声明了所需的配置来实例化项目的层次结构。在默认情况下，这个文件被命名为settings.gradle，并且和根项目的build.gradle文件放在一起，该文件在初始化阶段被执行。根项目就像一个容器，子项目会迭代访问它的配置并注入到自己的配置中。</p>
<p><strong>多项目构建</strong><br>
多项目构建总是需要指定一个树根，树中的每一个节点代表一个项目，每一个Project对象都指定有一个表示在树中位置的路径；在设置文件中我们还可以使用一套方法来自定义构建项目树。<br>
settings.gradle作用就是用于多项目构建，一般像这样：</p>
<pre><code class="language-java">//父模块名称
rootProject.name = 'nacos'
//引入子模块
include 'sentinel'
include 'openfeign'
include 'loadbalancer'
include 'gateway'
include 'rocketmq'
include 'sleuth'
include 'seata'
include 'provide'
findProject(':iot-service:user-center')?.name = 'user-center'
</code></pre>
<p><strong>buildScript</strong><br>
buildScript块的repositories主要是为了Gradle脚本自身的执行，获取脚本依赖插件。<br>
buildscript中的声明是gradle脚本自身需要使用的资源。可以声明的资源包括依赖项、第三方插件、maven仓库地址等。<br>
gradle在执行脚本时，会优先执行buildscript代码块中的内容，然后才会执行剩余的build脚本。</p>
<pre><code class="language-java">buildscript {
    ext {
        //spring-cloud-dependencies 2020.0.0 默认不在加载bootstrap 配置文件，
        //如果项目中要用bootstrap 配置文件 需要手动添加spring-cloud-starter-bootstrap 依赖，不然启动项目会报错的。
        set('springCloudVersion', &quot;2021.0.3&quot;)
        //定义一个变量，统一规定springboot的版本
        set('springBootVersion', &quot;2.6.8&quot;)
        set('alibabaVersion', &quot;2.2.7.RELEASE&quot;)
        set('lombok', &quot;1.18.16&quot;)
        set('knife4j', &quot;2.0.9&quot;)
        set('hutool', &quot;4.6.3&quot;)
        set('rocketmq', &quot;2.2.2&quot;)
    }
    repositories {
        mavenLocal()
        maven { url 'https://maven.aliyun.com/repository/central' }
        maven { url 'https://maven.aliyun.com/repository/public' }
        mavenCentral()
    }

    dependencies {
        //用来打包
        classpath(&quot;org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}&quot;)
    }
}
</code></pre>
<p>ext：ext是自定义属性，现在很多人都喜欢把所有关于版本的信息都利用ext放在另一个自己新建的gradle文件中集中管理。</p>
<p><strong>allprojects</strong><br>
allprojects块的repositories用于多项目构建，为所有项目提供共同所需依赖包。而子项目可以配置自己的repositories以获取自己独需的依赖包。</p>
<blockquote>
<p>buildscript和allprojects的作用和区别：<br>
buildscript中的声明是gradle脚本自身需要使用的资源，就是说它自己需要的资源，跟你其它模块其实并没有什么关系。而allprojects声明的却是<code>所有module</code>所需要使用的资源，就是说你的每个module都需要用同一个第三库的时候，可以在allprojects里面声明。</p>
</blockquote>
<pre><code class="language-java">allprojects {
    apply plugin: 'java-library'
    apply plugin: 'idea'

    //下面两句必须在所有子项目中添加，否则导致import了看起来没问题，但是编译时找不到其他模块的类。
    group = 'com.example'
    version = '0.0.1-SNAPSHOT'
    // 指定JDK版本
    sourceCompatibility = 1.8
    targetCompatibility = 1.8

    repositories {
        mavenLocal()
        maven { url 'https://maven.aliyun.com/repository/central' }
        maven { url 'https://maven.aliyun.com/repository/public' }
        mavenCentral()
    }

    //指定编码格式
    tasks.withType(JavaCompile) {
        options.encoding = &quot;UTF-8&quot;
    }
}
</code></pre>
<p><strong>subprojects子项目通用配置</strong><br>
subprojects是对所有Child Project的配置:</p>
<pre><code class="language-java">subprojects {
    apply plugin: 'java-library'
    apply plugin: 'idea'
    apply plugin: 'org.springframework.boot'
    //dependency-management 插件
    apply plugin: 'io.spring.dependency-management'

    repositories {
        mavenLocal()
        maven { url 'https://maven.aliyun.com/repository/central' }
        maven { url 'https://maven.aliyun.com/repository/public' }
        mavenCentral()
    }
    
    dependencies {
        implementation(enforcedPlatform(&quot;org.springframework.cloud:spring-cloud-dependencies:${springCloudVersion}&quot;))
        implementation(enforcedPlatform(&quot;com.alibaba.cloud:spring-cloud-alibaba-dependencies:${alibabaVersion}&quot;))
        implementation(enforcedPlatform(&quot;org.springframework.boot:spring-boot-dependencies:${springBootVersion}&quot;))
        implementation &quot;com.github.xiaoymin:knife4j-spring-boot-starter:${knife4j}&quot;
        implementation &quot;cn.hutool:hutool-all:${hutool}&quot;
        implementation 'org.springframework.boot:spring-boot-starter'
        implementation 'com.alibaba.cloud:spring-cloud-starter-alibaba-nacos-config'
        implementation('com.alibaba.cloud:spring-cloud-starter-alibaba-nacos-discovery'){
            exclude group: 'org.springframework.cloud', module: 'spring-cloud-starter-netflix-ribbon'
        }
        implementation 'org.springframework.cloud:spring-cloud-starter-bootstrap'
        compileOnly(&quot;org.projectlombok:lombok:${lombok}&quot;)
        annotationProcessor 'org.springframework.boot:spring-boot-configuration-processor'
        annotationProcessor(&quot;org.projectlombok:lombok:${lombok}&quot;)
        testImplementation(&quot;org.springframework.boot:spring-boot-starter-test:${springBootVersion}&quot;)
    }

    jar {
        manifest.attributes provider: 'gradle'
    }

}
</code></pre>
<h3 id="四-gradleproperties">四 gradle.properties</h3>
<p>gradle中的常用属性可以写在gradle.properties中。<br>
  一般我们都把全局属性都编写在一个工具类中，如果是有环境的切换的话，那么我们还会定义一个标志来进行相应的变换。对于项目而言，有时候需要配置某些敏感信息。比如密码，帐号等。而这些信息需要被很多类共同使用，所以必须有一个全局的配置。当需要把项目push到git上时，我们不希望别人看到我们项目的key，token等。我们可以将这些信息设置在gradle.properties中。<br>
只有在Android中才可使用。</p>
<pre><code class="language-java">AppKey = 1234567890
</code></pre>
<p>在build.gradle(module app)中进行变量的重定义，即将配置内容转化成java能够使用的形式:</p>
<pre><code class="language-java">android {
    buildTypes {
        release {
            minifyEnabled true
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
            //buildConfigField用于给BuildConfig文件添加一个字段
            buildConfigField(&quot;String&quot;,&quot;KEY&quot;,&quot;\&quot;${AppKey}\&quot;&quot;)
        }
        debug{
            buildConfigField(&quot;String&quot;,&quot;KEY&quot;,&quot;\&quot;${AppKey}\&quot;&quot;)
        }
    }
}
</code></pre>
<h3 id="五-gradle-插件plugins">五 Gradle 插件(Plugins)</h3>
<p>Gradle 也可以用下面的方式声明使用的插件：</p>
<pre><code class="language-java">// plugins DSL
plugins {
    id 'org.springframework.boot' version '2.2.1.RELEASE'
    id 'io.spring.dependency-management' version '1.0.8.RELEASE'
    id 'java'
}

// apply plugin
apply plugin: 'java-library'
apply plugin: 'idea'
apply plugin: 'org.springframework.boot'
//dependency-management 插件
apply plugin: 'io.spring.dependency-management'
</code></pre>
<p>其实是从 Gradle 官方的插件仓库<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fplugins.gradle.org%2Fm2%2F">https://plugins.gradle.org/m2/</a>下载的。</p>
<h3 id="六-常见的task命令">六 常见的task命令</h3>
<p><code>build</code>:当运行gradle build命令时Gradle将会编译和测试你的代码，并且创建一个包含类和资源的JAR文件。<br>
<code>clean</code>:当运行gradle clean命令时Gradle将会删除build生成的目录和所有生成的文件。<br>
<code>assemble</code>:当运行gradle assemble命令时Gradle将会编译并打包代码，但是并不运行单元测试。<br>
<code>check</code>:当运行gradle check命令时Gradle将会编译并测试你的代码，其他的插件会加入更多的检查步骤。</p>
<h3 id="七-gradle-wrapper">七 gradle-wrapper</h3>
<p>Wrapper是对Gradle的一层包装，便于在团队开发过程中统一Gradle构建的版本号，这样大家都可以使用统一的Gradle版本进行构建。</p>
<figure data-type="image" tabindex="2"><img src="https://tinaxiawuhao.github.io/post-images/1657022568864.png" alt="img" loading="lazy"></figure>
<pre><code class="language-java">distributionBase=GRADLE_USER_HOME
distributionPath=wrapper/dists
distributionUrl=https\://services.gradle.org/distributions/gradle-7.4.2-bin.zip
#distributionUrl=file:///E:/gradle/gradle-7.4.2-all.zip
zipStoreBase=GRADLE_USER_HOME
zipStorePath=wrapper/dists
</code></pre>
<p>distributionUrl是要下载的gradle的地址，使用哪个版本的gradle，就在这里修改。</p>
<p>gradle的3种版本：<br>
gradle-xx-all.zip是完整版，包含了各种二进制文件，源代码文件，和离线的文档。<br>
gradle-xx-bin.zip是二进制版，只包含了二进制文件（可执行文件），没有文档和源代码。<br>
gradle-xx-src.zip是源码版，只包含了Gradle源代码，不能用来编译你的工程。</p>
<p>zipStoreBase和zipStorePath组合在一起，是下载的gradle-3.1-bin.zip所存放的位置。<br>
zipStorePath是zipStoreBase指定的目录下的子目录。</p>
<p>distributionBase和distributionPath组合在一起，是解压gradle-5.6.4-bin.zip之后的文件的存放位置。<br>
distributionPath是distributionBase指定的目录下的子目录。</p>
<p>下载位置可以和解压位置不一样。</p>
<p>zipStoreBase和distributionBase有两种取值：GRADLE_USER_HOME和PROJECT。<br>
其中，GRADLE_USER_HOME表示用户目录。<br>
在windows下是%USERPROFILE%/.gradle，例如C:\Users&lt;user_name&gt;.gradle\。<br>
在linux下是$HOME/.gradle，例如~/.gradle。<br>
PROJECT表示工程的当前目录，即gradlew所在的目录。</p>
<h3 id="八-依赖分组">八 依赖分组</h3>
<p>Gradle 依赖是分组的 ,分组是在 org.gradle.api.Project 中的 configurations 中配置的 ,如 &quot; implementation &quot; , &quot; compile &quot; 等都是分组 , 这些分组都是在 org.gradle.api.Project#configurations 中进行配置 , 也就是 build.gradle#configurations 中配置 ;</p>
<p><strong>build.gradle#configurations 自定义依赖分组</strong></p>
<p>在 build.gradle 中配置 configurations :</p>
<pre><code class="language-groovy">configurations {
  hello {
  }
}
</code></pre>
<p>则可以在 dependencies 中使上述在 configurations 配置的依赖分组 hello ,</p>
<pre><code class="language-java">dependencies {
  hello 'com.android.support:appcompat-v7:28.0.0'
}
</code></pre>
<h3 id="九-依赖版本冲突">九 依赖版本冲突</h3>
<p>Gradle对解决传递依赖提供了两种策略，使用最新版本或者直接导致构建失败。默认的策略是使用最新版本。虽然这样的策略能够解决一些问题，但是还是不够。常见的一种情况是，NoSuchMethond或者ClassNotFound。这时候，你可能需要一些特殊手段，比如排除不想要的传递依赖。<br>
排除传递依赖的方式有两种：</p>
<blockquote>
<p>1.使用transitive = false排除</p>
<p>2.在具体的某个dependency中使用exclude排除</p>
<p>3.使用force强制依赖某个版本</p>
</blockquote>
<pre><code class="language-java">(1) 方案一：针对 A 或 D 配置 transitive。
    这里针对A配置，不解析A模块的传递依赖，因此当前Module的依赖关系树中不再包含 B1 和 C，这里需要手动添加依赖 C
dependencies {
    implementation A {
      transitive = false
    }
    implementation C
    implementation D {
      //transitive = false
    }
}

(2) 方案二：针对 A 或 D 配置 exclude规则，此处针对A配置，依赖关系树中不再包含B1
dependencies {
    implementation A {
      exclude  B1
    }
    implementation D {
      //exclude  B2
    }
}

(3) 方案三：使用force强制依赖某个版本，如强制依赖 B1 或者 B2
        以下是在顶层build.gradle中配置，强制所有module依赖B1
configurations.all {
    resolutionStrategy {
       force B1
       // force B2
    }
}
</code></pre>
<h3 id="十-springcloud-gradle管理">十 springcloud-gradle管理</h3>
<p><strong>parent:settings.gradle</strong></p>
<pre><code class="language-groovy">rootProject.name = 'nacos'
include 'sentinel'
include 'openfeign'
include 'loadbalancer'
include 'gateway'
include 'rocketmq'
include 'sleuth'
include 'seata'
include 'provide'
</code></pre>
<p><strong>parent:build.gradle</strong></p>
<pre><code class="language-groovy">buildscript {
    ext {
        //spring-cloud-dependencies 2020.0.0 默认不在加载bootstrap 配置文件，
        //如果项目中要用bootstrap 配置文件 需要手动添加spring-cloud-starter-bootstrap 依赖，不然启动项目会报错的。
        set('springCloudVersion', &quot;2021.0.3&quot;)
        //定义一个变量，统一规定springboot的版本
        set('springBootVersion', &quot;2.6.8&quot;)
        set('alibabaVersion', &quot;2.2.7.RELEASE&quot;)
        set('lombok', &quot;1.18.16&quot;)
        set('knife4j', &quot;2.0.9&quot;)
        set('hutool', &quot;4.6.3&quot;)
        set('rocketmq', &quot;2.2.2&quot;)
    }
    repositories {
        mavenLocal()
        maven { url 'https://maven.aliyun.com/repository/central' }
        maven { url 'https://maven.aliyun.com/repository/public' }
        mavenCentral()
    }

    dependencies {
        //用来打包
        classpath(&quot;org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}&quot;)
    }
}

allprojects {
    apply plugin: 'java-library'
    apply plugin: 'idea'

    //下面两句必须在所有子项目中添加，否则导致import了看起来没问题，但是编译时找不到其他模块的类。
    group = 'com.example'
    version = '0.0.1-SNAPSHOT'
    // 指定JDK版本
    sourceCompatibility = 1.8
    targetCompatibility = 1.8

    repositories {
        mavenLocal()
        maven { url 'https://maven.aliyun.com/repository/central' }
        maven { url 'https://maven.aliyun.com/repository/public' }
        mavenCentral()
    }

    //指定编码格式
    tasks.withType(JavaCompile) {
        options.encoding = &quot;UTF-8&quot;
    }
}


subprojects {
    apply plugin: 'java-library'
    apply plugin: 'idea'
    apply plugin: 'org.springframework.boot'
    //dependency-management 插件
    apply plugin: 'io.spring.dependency-management'

    dependencies {
        implementation(enforcedPlatform(&quot;org.springframework.cloud:spring-cloud-dependencies:${springCloudVersion}&quot;))
        implementation(enforcedPlatform(&quot;com.alibaba.cloud:spring-cloud-alibaba-dependencies:${alibabaVersion}&quot;))
        implementation(enforcedPlatform(&quot;org.springframework.boot:spring-boot-dependencies:${springBootVersion}&quot;))
        implementation &quot;com.github.xiaoymin:knife4j-spring-boot-starter:${knife4j}&quot;
        implementation &quot;cn.hutool:hutool-all:${hutool}&quot;
        implementation 'org.springframework.boot:spring-boot-starter'
        implementation 'com.alibaba.cloud:spring-cloud-starter-alibaba-nacos-config'
        implementation('com.alibaba.cloud:spring-cloud-starter-alibaba-nacos-discovery'){
            exclude group: 'org.springframework.cloud', module: 'spring-cloud-starter-netflix-ribbon'
        }
        implementation 'org.springframework.cloud:spring-cloud-starter-bootstrap'
        compileOnly(&quot;org.projectlombok:lombok:${lombok}&quot;)
        annotationProcessor 'org.springframework.boot:spring-boot-configuration-processor'
        annotationProcessor(&quot;org.projectlombok:lombok:${lombok}&quot;)
        testImplementation(&quot;org.springframework.boot:spring-boot-starter-test:${springBootVersion}&quot;)
    }

    jar {
        manifest.attributes provider: 'gradle'
    }

}
</code></pre>
<p><strong>gateway:build.gradle</strong></p>
<pre><code class="language-groovy">dependencies {
	implementation &quot;org.springframework.cloud:spring-cloud-starter-gateway&quot;
	implementation &quot;org.springframework.cloud:spring-cloud-starter-loadbalancer&quot;
}
</code></pre>
<p><strong>openfeign:build.gradle</strong></p>
<pre><code class="language-groovy">dependencies {
	implementation 'org.springframework.boot:spring-boot-starter-web'
	implementation &quot;org.springframework.cloud:spring-cloud-starter-openfeign&quot;
	implementation &quot;org.springframework.cloud:spring-cloud-starter-loadbalancer&quot;
}

</code></pre>
<p><strong>rocketmq:build.gradle</strong></p>
<pre><code class="language-groovy">dependencies {
	implementation 'org.springframework.boot:spring-boot-starter-web'
	implementation &quot;org.apache.rocketmq:rocketmq-spring-boot-starter:${rocketmq}&quot;
}
</code></pre>
<p><strong>sentinel:build.gradle</strong></p>
<pre><code class="language-groovy">dependencies {
	implementation 'org.springframework.boot:spring-boot-starter-web'
	implementation 'com.alibaba.cloud:spring-cloud-starter-alibaba-sentinel'
	implementation 'org.springframework.boot:spring-boot-starter-actuator'
}
</code></pre>
<h3 id="项目构建-gradle-docker打包">项目构建--Gradle--Docker打包</h3>
<p>在<code>build.gradle</code>中引入插件。</p>
<pre><code class="language-java"> id &quot;com.google.cloud.tools.jib&quot; version &quot;3.2.1&quot;
</code></pre>
<figure data-type="image" tabindex="3"><img src="https://tinaxiawuhao.github.io/post-images/1657022594521.png" alt="img" loading="lazy"></figure>
<p><strong>配置</strong><br>
配置打包时的基础镜像、容器配置、私服地址等，和Maven 插件中的一样，只是采用闭包的书写方式。</p>
<p><a href="https://github.com/GoogleContainerTools/jib/tree/master/jib-gradle-plugin#quickstart">Jib 官网文档</a></p>
<pre><code class="language-java">jib {
    // 基础镜像，来自dockerhub,如果是私服，需要加上鉴权信息，和to下的auth节点相同
    // https://hub.docker.com/
    from {
        image = 'xx'
    }
    // 构建后的镜像名称以及私服地址、鉴权信息
    to {
        image = 'xx'
        auth {
            username = '登录账号'
            password = '登录密码'
        }
    }
    // 容器相关设置
    container {
        // 创建时间
        creationTime = new Date()
        // JVM 启动参数
        jvmFlags = ['-Djava.security.egd=file:/dev/./urandom', '-Dspring.profiles.active=prod', '-Dfile.encoding=utf-8', '-Duser.timezone=GMT+08']
        // 启动类
        // mainClass = 'com.xxx.RunApplication'
        // 容器在运行时公开的端口
        ports = ['8080']
        // 放置应用程序内容的容器上的根目录
        appRoot = '/deploy/service'
    }
}
</code></pre>
<h4 id="使用ideadocker插件布署">使用IdeaDocker插件布署</h4>
<p><strong>Idea安装插件</strong></p>
<figure data-type="image" tabindex="4"><img src="https://tinaxiawuhao.github.io/post-images/1657022607710.png" alt="img" loading="lazy"></figure>
<figure data-type="image" tabindex="5"><img src="https://tinaxiawuhao.github.io/post-images/1657022616011.png" alt="img" loading="lazy"></figure>
<p><strong>安装docker插件</strong></p>
<ol>
<li>配置docker：</li>
</ol>
<figure data-type="image" tabindex="6"><img src="https://tinaxiawuhao.github.io/post-images/1657022629349.png" alt="img" loading="lazy"></figure>
<figure data-type="image" tabindex="7"><img src="https://tinaxiawuhao.github.io/post-images/1657022637131.png" alt="img" loading="lazy"></figure>
<figure data-type="image" tabindex="8"><img src="https://tinaxiawuhao.github.io/post-images/1657022644128.png" alt="img" loading="lazy"></figure>
<p><strong>配置Dockerfile文件</strong><br>
1）新建Dockerfile文件会自动弹出。</p>
<figure data-type="image" tabindex="9"><img src="https://tinaxiawuhao.github.io/post-images/1657022651578.png" alt="img" loading="lazy"></figure>
<p>在工程根目录下新建Dockerfile文件，内容如下：</p>
<pre><code class="language-dockerfile">FROM openjdk:8
COPY build/libs/iot-eruake-1.0.0.jar app.jar
RUN bash -c &quot;touch /app.jar&quot;
EXPOSE 8080
ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;app.jar&quot;]
</code></pre>
<p><strong>创建docker镜像</strong></p>
<figure data-type="image" tabindex="10"><img src="https://tinaxiawuhao.github.io/post-images/1657022660226.png" alt="img" loading="lazy"></figure>
<figure data-type="image" tabindex="11"><img src="https://tinaxiawuhao.github.io/post-images/1657022667209.png" alt="img" loading="lazy"></figure>
<figure data-type="image" tabindex="12"><img src="https://tinaxiawuhao.github.io/post-images/1657022673583.png" alt="img" loading="lazy"></figure>
<figure data-type="image" tabindex="13"><img src="https://tinaxiawuhao.github.io/post-images/1657022680599.png" alt="img" loading="lazy"></figure>
<p><strong>发布完成</strong></p>
<figure data-type="image" tabindex="14"><img src="https://tinaxiawuhao.github.io/post-images/1657022687210.png" alt="img" loading="lazy"></figure>

          <div class="toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li>
<ul>
<li><a href="#%E4%B8%80-%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86">一 依赖管理</a></li>
<li><a href="#%E4%BA%8C-%E4%BB%93%E5%BA%93">二 仓库</a></li>
<li><a href="#%E4%B8%89-%E5%A4%9A%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA">三 多项目构建</a></li>
<li><a href="#%E5%9B%9B-gradleproperties">四 gradle.properties</a></li>
<li><a href="#%E4%BA%94-gradle-%E6%8F%92%E4%BB%B6plugins">五 Gradle 插件(Plugins)</a></li>
<li><a href="#%E5%85%AD-%E5%B8%B8%E8%A7%81%E7%9A%84task%E5%91%BD%E4%BB%A4">六 常见的task命令</a></li>
<li><a href="#%E4%B8%83-gradle-wrapper">七 gradle-wrapper</a></li>
<li><a href="#%E5%85%AB-%E4%BE%9D%E8%B5%96%E5%88%86%E7%BB%84">八 依赖分组</a></li>
<li><a href="#%E4%B9%9D-%E4%BE%9D%E8%B5%96%E7%89%88%E6%9C%AC%E5%86%B2%E7%AA%81">九 依赖版本冲突</a></li>
<li><a href="#%E5%8D%81-springcloud-gradle%E7%AE%A1%E7%90%86">十 springcloud-gradle管理</a></li>
<li><a href="#%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA-gradle-docker%E6%89%93%E5%8C%85">项目构建--Gradle--Docker打包</a>
<ul>
<li><a href="#%E4%BD%BF%E7%94%A8ideadocker%E6%8F%92%E4%BB%B6%E5%B8%83%E7%BD%B2">使用IdeaDocker插件布署</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
          
              <hr />
            
          
            
            <p class="next-post">上一篇：
                <a href="https://tinaxiawuhao.github.io/post/4WluurBt3/">
                  <span class="post-title">
                    IdWorker雪花算法&rarr;
                  </span>
                </a>
              </p>
            
          
            
           <p class="prev-post">下一篇：
                 <a href="https://tinaxiawuhao.github.io/post/Ke4qDxE4l/">
                   <span class="post-title">
                     Gradle基础&rarr;
                   </span>
                 </a>
               </p>
          
          <div class="comment" style="text-align: center;">
            

            
            
          </div>
        </div>
      </div>
  </article>
  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <ul class="list-inline text-center">
            
            
            <li class="list-inline-item">
              <a href="https://github.com/tinaxiawuhao" target="_blank">
                <span class="fa-stack fa-lg">
                  <i class="fas fa-circle fa-stack-2x"></i>
                  <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
            
              
            
              
            
              
            
              
            
              
            
              
            
              
              <!-- <li class="list-inline-item">
              <a href="https://tinaxiawuhao.github.io/atom.xml" target="_blank">
                <span class="fa-stack fa-lg">
                  <i class="fas fa-circle fa-stack-2x"></i>
                  <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
                </span>
              </a>
              </li> -->
          </ul>
          <p class="copyright text-muted">Copyright &copy;<span>tianxia</span><br><a href="https://github.com/getgridea/gridea" class="Themeinfo">Powered by Gridea</a></p>
        </div>
      </div>
    </div>
   </footer>
  <!-- Bootstrap core JavaScript -->
  <script src="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
  <!-- <script src="https://tinaxiawuhao.github.io/media/scripts/bootstrap.bundle.min.js"></script> -->
  <!-- Bootstrap core JavaScript -->
  <script src="https://cdn.jsdelivr.net/gh/Alanrk/clean-cdn@1.0/scripts/clean-blog.min.js"></script>
  <!-- <script src="https://tinaxiawuhao.github.io/media/scripts/clean-blog.min.js"></script> -->
  <style type="text/css">a.back_to_top{text-decoration:none;position:fixed;bottom:40px;right:30px;background:#f0f0f0;height:40px;width:40px;border-radius:50%;line-height:36px;font-size:18px;text-align:center;transition-duration:.5s;transition-propety:background-color;display:none}a.back_to_top span{color:#888}a.back_to_top:hover{cursor:pointer;background:#dfdfdf}a.back_to_top:hover span{color:#555}@media print,screen and(max-width:580px){.back_to_top{display:none!important}}</style>
<a id="back_to_top" href="#" class="back_to_top">
  <span>▲</span></a>
<script>$(document).ready((function(_this) {
    return function() {
      var bt;
      bt = $('#back_to_top');
      if ($(document).width() > 480) {
        $(window).scroll(function() {
          var st;
          st = $(window).scrollTop();
          if (st > 30) {
            return bt.css('display', 'block')
          } else {
            return bt.css('display', 'none')
          }
        });
        return bt.click(function() {
          $('body,html').animate({
            scrollTop: 0
          },
          800);
          return false
        })
      }
    }
  })(this));</script>
  
  <div id="landlord-parent">
    <div id="landlord">
        <div class="message" style="opacity:0"></div>
        <canvas id="live2d" width="240" height="250" class="live2d"></canvas>
    </div>
</div>

<script type="text/javascript">
    if (/(iPhone|iPad|iPod|iOS|Android)/i.test(navigator.userAgent)) {
        //移动端
        console.log("------ 移动端");
    } else {
        console.log("------ PC端 " + navigator.userAgent);

        addScript("https://cdn.jsdelivr.net/gh/850552586/ericamcdn@0.1/js/live2d.js", () => {
            // 加载完成后再loadlive2d
            loadlive2d("live2d", "https://tinaxiawuhao.github.io/media/live2d/assets/tororo.model.json");
        });

        var home_Path = "https://tinaxiawuhao.github.io/";
        addScript("https://tinaxiawuhao.github.io/media/live2d/js/message.js", () => { });
    }

    // 插入js文件，完成后callback
    function addScript(jsfile, callback) {
        var landlord_parent = document.getElementById("landlord-parent");
        var script = document.createElement("script");
        script.type = "text/javascript";
        script.src = jsfile;
        landlord_parent.appendChild(script);
        script.onload = script.onreadystatechange = function () {
            if (!this.readyState || this.readyState === "loaded" || this.readyState === "complete") {
                script.onload = script.onreadystatechange = null;
                if (callback && typeof callback == "function") {
                    callback(); //window[callback]();如果传递字符串过来 调用window['函数名']() 调用方法
                }
            }
        };
    }
</script>
  
  <script src="https://tinaxiawuhao.github.io/media/scripts/tocScript.js"></script>
</body>

</html>