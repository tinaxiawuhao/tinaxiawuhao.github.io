<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<meta name="referrer" content="never">
<meta name="keywords" content="">
<meta name="description" content="欢迎访问[tianxia]的个人博客">
<meta name="author" content="kveln">
<title>gradle依赖,插件 | tianxia</title>
<link rel="stylesheet" href="https://tinaxiawuhao.github.io/resource/bootstrap.min.css">
<link href="https://tinaxiawuhao.github.io/resource/all.min.css" rel="stylesheet">
<link rel="alternate" type="application/rss+xml" title="gradle依赖,插件 | tianxia » Feed"
  href="https://tinaxiawuhao.github.io/atom.xml">
<link rel="stylesheet"
  href="https://tinaxiawuhao.github.io/resource/androidstudio.min.css">
<link href="https://tinaxiawuhao.github.io/styles/main.css" rel="stylesheet">
<script src="https://tinaxiawuhao.github.io/resource/jquery.min.js"></script>

<script src="https://tinaxiawuhao.github.io/resource/highlight.min.js"></script>

<link rel="stylesheet" href="https://tinaxiawuhao.github.io/resource/live2d.css">

<script>hljs.initHighlightingOnLoad();</script>

  <meta property="og:description" content="gradle依赖,插件" />
  <meta property="og:url" content="https://tinaxiawuhao.github.io/post/Fe3q50EYd/" />
  <meta property="og:locale" content="zh-CN" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="tianxia" />
  <!-- <script src="../assets/styles/scripts/tocScript.js"></script> -->
</head>

<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="https://tinaxiawuhao.github.io">tianxia</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
      data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
      aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        
        <li class="nav-item">
          
          <a class="nav-link" href="/">首页</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/archives">归档</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/tags">标签</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/post/about">关于</a>
          
        </li>
        
        <li class="nav-item">
          <div class="gridea-search-container">
            <form id="gridea-search-form" style="position: relative" data-update="1659699703857"
              action="/search/index.html">
              <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
              <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>
  <!-- Page Header -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="https://tinaxiawuhao.github.io">tianxia</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
      data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
      aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        
        <li class="nav-item">
          
          <a class="nav-link" href="/">首页</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/archives">归档</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/tags">标签</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/post/about">关于</a>
          
        </li>
        
        <li class="nav-item">
          <div class="gridea-search-container">
            <form id="gridea-search-form" style="position: relative" data-update="1659699703857"
              action="/search/index.html">
              <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
              <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>
<header class="masthead" style="background-image: url('https://tinaxiawuhao.github.io/media/images/home-bg.jpg')">
  <div class="overlay"></div>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        
          <!-- 没Title为其他页面Header -->
          
            <!-- 没Title并且有headerType为Post：文章Header -->
            <div class="post-heading">
              <span class="tags">
                
                <a href="https://tinaxiawuhao.github.io/tag/_whMOC5wx/" class="tag">gradle</a>
                
              </span>
              <h1>gradle依赖,插件</h1>
              <span class="meta">
                Posted on
                2021-07-06，21 min read
              </span>
            </div>
          
        
      </div>
    </div>
  </div>
</header>
  <!-- Post Content -->
  <article id="post-content-article">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto post-content-container">
          
          <img class="post-feature-header-image" src="https://tinaxiawuhao.github.io/post-images/Fe3q50EYd.png" alt="封面图">
          </img>
          
          <h1 id="依赖">依赖</h1>
<h2 id="configurations">configurations</h2>
<p>设置configurations 配置依赖信息</p>
<p>build.gradle</p>
<pre><code class="language-java">configurations {
    // 针对需要组件API的消费者的配置
    exposedApi {
        // canBeResolved 为true 则为可解析配置，为消费者
        canBeResolved = false
        // canBeConsumed 为true 则为消费析配置，为生产者
        canBeConsumed = true
    }
    // 为需要实现该组件的消费者提供的配置。
    exposedRuntime {
        canBeResolved = false
        canBeConsumed = true
    }
}
</code></pre>
<h2 id="依赖方式">依赖方式</h2>
<h3 id="模块依赖">模块依赖</h3>
<p>build.gradle</p>
<pre><code class="language-java">dependencies {
    runtimeOnly group: 'org.springframework', name: 'spring-core', version: '2.5'
    runtimeOnly 'org.springframework:spring-core:2.5',
            'org.springframework:spring-aop:2.5'
    runtimeOnly(
        [group: 'org.springframework', name: 'spring-core', version: '2.5'],
        [group: 'org.springframework', name: 'spring-aop', version: '2.5']
    )
    runtimeOnly('org.hibernate:hibernate:3.0.5') {
        transitive = true
    }
    runtimeOnly group: 'org.hibernate', name: 'hibernate', version: '3.0.5', transitive: true
    runtimeOnly(group: 'org.hibernate', name: 'hibernate', version: '3.0.5') {
        transitive = true
    }
}
</code></pre>
<h3 id="文件依赖">文件依赖</h3>
<p>build.gradle</p>
<pre><code class="language-java">dependencies {
    runtimeOnly files('libs/a.jar', 'libs/b.jar')
    runtimeOnly fileTree('libs') { include '*.jar' }
}
</code></pre>
<h3 id="项目依赖">项目依赖</h3>
<p>build.gradle</p>
<pre><code class="language-java">dependencies {
    implementation project(':shared')
}
</code></pre>
<h2 id="依赖方式-2">依赖方式</h2>
<ul>
<li>compileOnly —用于编译生产代码所必需的依赖关系，但不应该属于运行时类路径的一部分</li>
<li>implementation（取代compile）-用于编译和运行时</li>
<li>runtimeOnly（取代runtime）-仅在运行时使用，不用于编译</li>
<li>testCompileOnly—与compileOnly测试相同</li>
<li>testImplementation —测试相当于 implementation</li>
<li>testRuntimeOnly —测试相当于 runtimeOnly</li>
</ul>
<h2 id="repositories">repositories</h2>
<p>流行的公共存储库包括Maven Central， Bintray JCenter和Google Android存储库。<br>
<img src="https://tinaxiawuhao.github.io/post-images/1658230851306.png" alt="" loading="lazy"></p>
<pre><code class="language-java">repositories {
    
    mavenCentral() // Maven Central存储库  
    jcenter() // JCenter Maven存储库
    google() // Google Maven存储库
        
    mavenLocal()   // 将本地Maven缓存添加为存储库（不推荐）
    //flat存储库解析器
    flatDir {
        dirs 'lib'
    }
    flatDir {
        dirs 'lib1', 'lib2'
    }
    
    //添加定制的Maven仓库
    maven {
        url &quot;http://repo.mycompany.com/maven2&quot;
        // 为JAR文件添加附加的Maven存储库
        artifactUrls &quot;http://repo.mycompany.com/jars&quot;
    }
    
    //Ivy
     ivy {
        url &quot;http://repo.mycompany.com/repo&quot;
        layout &quot;maven&quot;  // 有效的命名布局值是'gradle'（默认值）'maven'和'ivy'。
    }
}
</code></pre>
<h3 id="声明存储库过滤器">声明存储库过滤器</h3>
<p>声明存储库内容</p>
<p>build.gradle</p>
<pre><code class="language-java">repositories {
    maven {
        url &quot;https://repo.mycompany.com/maven2&quot;
        content {
            // this repository *only* contains artifacts with group &quot;my.company&quot;
            includeGroup &quot;my.company&quot;
        }
    }
    jcenter {
        content {
            // this repository contains everything BUT artifacts with group starting with &quot;my.company&quot;
            excludeGroupByRegex &quot;my\\.company.*&quot;
        }
    }
}
</code></pre>
<p>默认情况下，存储库包含所有内容，不包含任何内容：</p>
<ul>
<li>如果声明include，那么它排除了一切 include 以外的内容。</li>
<li>如果声明exclude，则它将包括除exclude之外的所有内容。</li>
<li>如果声明include和exclude，则它仅包括显式包括但不排除的内容。</li>
</ul>
<h3 id="分割快照和发行版">分割快照和发行版</h3>
<p>build.gradle</p>
<pre><code class="language-java">repositories {
    maven {
        url &quot;https://repo.mycompany.com/releases&quot;
        mavenContent {
            releasesOnly()
        }
    }
    maven {
        url &quot;https://repo.mycompany.com/snapshots&quot;
        mavenContent {
            snapshotsOnly()
        }
    }
}
</code></pre>
<h3 id="支持的元数据源">支持的元数据源</h3>
<p>受支持的元数据源</p>
<table>
<thead>
<tr>
<th style="text-align:left">元数据源</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">排序</th>
<th style="text-align:left">Maven</th>
<th style="text-align:left">Ivy/flat dir</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">gradleMetadata()</td>
<td style="text-align:left">寻找Gradle.module文件</td>
<td style="text-align:left">1</td>
<td style="text-align:left">是</td>
<td style="text-align:left">是</td>
</tr>
<tr>
<td style="text-align:left">mavenPom()</td>
<td style="text-align:left">查找Maven.pom文件</td>
<td style="text-align:left">2</td>
<td style="text-align:left">是</td>
<td style="text-align:left">是</td>
</tr>
<tr>
<td style="text-align:left">ivyDescriptor()</td>
<td style="text-align:left">查找ivy.xml文件</td>
<td style="text-align:left">2</td>
<td style="text-align:left">没有</td>
<td style="text-align:left">是</td>
</tr>
<tr>
<td style="text-align:left">artifact()</td>
<td style="text-align:left">直接寻找artifact</td>
<td style="text-align:left">3</td>
<td style="text-align:left">是</td>
<td style="text-align:left">是</td>
</tr>
</tbody>
</table>
<p>从Gradle 5.3开始，解析元数据文件（无论是Ivy还是Maven）时，Gradle将寻找一个标记，指示存在匹配的Gradle Module元数据文件。如果找到它，它将代替Ivy或Maven文件使用。</p>
<p>从Gradle5.6开始，您可以通过添加ignoreGradleMetadataRedirection()到metadataSources声明来禁用此行为。</p>
<p>例.不使用gradle元数据重定向的Maven存储库</p>
<p>build.gradle</p>
<pre><code class="language-java">repositories {
    maven {
        url &quot;http://repo.mycompany.com/repo&quot;
        metadataSources {
            mavenPom()
            artifact()
            ignoreGradleMetadataRedirection()
        }
    }
}
</code></pre>
<h2 id="gav坐标">GAV坐标</h2>
<p>GAV坐标一般指group，artifact，version</p>
<h2 id="变体">变体</h2>
<p>构建变体是针对不同环境的配置，例如android开发中一般有debug和release两种变体<br>
<img src="https://tinaxiawuhao.github.io/post-images/1658230892932.png" alt="" loading="lazy"></p>
<h3 id="声明功能变体">声明功能变体</h3>
<p>可以通过应用<code>java</code>或<code>java-library</code>插件来声明功能变体。以下代码说明了如何声明名为<code>mongodbSupport</code>的功能：</p>
<p>示例1.声明一个功能变量</p>
<pre><code class="language-java">Groovy``Kotlin
</code></pre>
<p>build.gradle</p>
<pre><code class="language-java">group = 'org.gradle.demo'
version = '1.0'
 
java {
    registerFeature('mongodbSupport') {
        usingSourceSet(sourceSets.main)
    }
}
</code></pre>
<h2 id="元数据">元数据</h2>
<p>从存储库中提取的每个模块都有与之关联的元数据，例如其组，名称，版本以及它提供的带有工件和依赖项的不同变体</p>
<p>可配置组件元数据规则的示例</p>
<p>build.gradle</p>
<pre><code class="language-java">class TargetJvmVersionRule implements ComponentMetadataRule {
    final Integer jvmVersion
    @Inject TargetJvmVersionRule(Integer jvmVersion) {
        this.jvmVersion = jvmVersion
    }
 
    @Inject ObjectFactory getObjects() { }
 
    void execute(ComponentMetadataContext context) {
        context.details.withVariant(&quot;compile&quot;) {
            attributes {
                attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, jvmVersion)
                attribute(Usage.USAGE_ATTRIBUTE, objects.named(Usage, Usage.JAVA_API))
            }
        }
    }
}
dependencies {
    components {
        withModule(&quot;commons-io:commons-io&quot;, TargetJvmVersionRule) {
            params(7)
        }
        withModule(&quot;commons-collections:commons-collections&quot;, TargetJvmVersionRule) {
            params(8)
        }
    }
    implementation(&quot;commons-io:commons-io:2.6&quot;)
    implementation(&quot;commons-collections:commons-collections:3.2.2&quot;)
}
</code></pre>
<p>可以通过以下方法进行修改变体：</p>
<ul>
<li>allVariants：修改组件的所有变体</li>
<li>withVariant(name)：修改由名称标识的单个变体</li>
<li>addVariant(name)或addVariant(name, base)：从头开始 或通过 复制 现有变体的详细信息（基础）向组件添加新变体</li>
</ul>
<p>可以调整每个变体的以下详细信息：</p>
<ul>
<li>标识变体的属性-attributes {}块</li>
<li>该变体提供的功能-withCapabilities { }块</li>
<li>变体的依赖项，包括丰富的版本-withDependencies {}块</li>
<li>变体的依赖关系约束，包括丰富版本-withDependencyConstraints {}块</li>
<li>构成变体实际内容的已发布文件的位置-withFiles { }块</li>
</ul>
<h2 id="平台">平台</h2>
<h3 id="使用平台">使用平台</h3>
<p>获取平台中声明的版本</p>
<p>build.gradle</p>
<pre><code class="language-java">dependencies {
    // get recommended versions from the platform project
    api platform(project(':platform'))
    // no version required
    api 'commons-httpclient:commons-httpclient'
}
</code></pre>
<p>platform表示法是一种简写表示法，实际上在后台执行了一些操作：</p>
<ul>
<li>它将org.gradle.category属性设置为platform，这意味着Gradle将选择依赖项的 平台 组件。</li>
<li>它默认设置endorseStrictVersions行为， 这意味着如果平台声明了严格的依赖关系，则将强制执行它们。</li>
</ul>
<p>这意味着默认情况下，对平台的依赖项会触发该平台中定义的所有严格版本的继承， 这对于平台作者确保所有使用者在依赖项的版本方面都遵循自己的决定很有用。 可以通过显式调用doNotEndorseStrictVersions方法来将其关闭。</p>
<p>例.依靠一个BOM导入其依赖约束</p>
<p>build.gradle</p>
<pre><code class="language-java">dependencies {
    // import a BOM
    implementation platform('org.springframework.boot:spring-boot-dependencies:1.5.8.RELEASE')
 
    // define dependencies without versions
    implementation 'com.google.code.gson:gson'
    implementation 'dom4j:dom4j'
}
</code></pre>
<p>导入BOM，确保其定义的版本覆盖找到的任何其他版本</p>
<p>build.gradle</p>
<pre><code class="language-java">dependencies {
    // import a BOM. The versions used in this file will override any other version found in the graph
    implementation enforcedPlatform('org.springframework.boot:spring-boot-dependencies:1.5.8.RELEASE')
 
    // define dependencies without versions
    implementation 'com.google.code.gson:gson'
    implementation 'dom4j:dom4j'
 
    // this version will be overridden by the one found in the BOM
    implementation 'org.codehaus.groovy:groovy:1.8.6'
}
</code></pre>
<h2 id="capability">Capability</h2>
<h3 id="声明组件的capability">声明组件的capability</h3>
<p>build.gradle</p>
<pre><code class="language-java">configurations {
    apiElements {
        outgoing {
            capability(&quot;com.acme:my-library:1.0&quot;)
            capability(&quot;com.other:module:1.1&quot;)
        }
    }
    runtimeElements {
        outgoing {
            capability(&quot;com.acme:my-library:1.0&quot;)
            capability(&quot;com.other:module:1.1&quot;)
        }
    }
}
</code></pre>
<h3 id="解决冲突">解决冲突</h3>
<p>按Capability（能力）解决冲突，（若存在相同能力的依赖性会失败）</p>
<p>build.gradle</p>
<pre><code class="language-java">@CompileStatic
class AsmCapability implements ComponentMetadataRule {
    void execute(ComponentMetadataContext context) {
        context.details.with {
            if (id.group == &quot;asm&quot; &amp;&amp; id.name == &quot;asm&quot;) {
                allVariants {
                    it.withCapabilities {
                        // Declare that ASM provides the org.ow2.asm:asm capability, but with an older version
                        it.addCapability(&quot;org.ow2.asm&quot;, &quot;asm&quot;, id.version)
                    }
                }
            }
        }
    }
}
 
</code></pre>
<p>一个带有日志框架隐式冲突的构建文件</p>
<p>build.gradle</p>
<pre><code class="language-java">dependencies {
    // Activate the &quot;LoggingCapability&quot; rule
    components.all(LoggingCapability)
}
 
@CompileStatic
class LoggingCapability implements ComponentMetadataRule {
    final static Set&lt;String&gt; LOGGING_MODULES = [&quot;log4j&quot;, &quot;log4j-over-slf4j&quot;] as Set&lt;String&gt;
 
    void execute(ComponentMetadataContext context) {
        context.details.with {
            if (LOGGING_MODULES.contains(id.name)) {
                allVariants {
                    it.withCapabilities {
                        // Declare that both log4j and log4j-over-slf4j provide the same capability
                        it.addCapability(&quot;log4j&quot;, &quot;log4j&quot;, id.version)
                    }
                }
            }
        }
    }
}
</code></pre>
<h2 id="版本">版本</h2>
<h3 id="版本规则">版本规则</h3>
<p>Gradle支持不同的版本字符串声明方式：</p>
<ul>
<li>
<p>一个确切的版本：比如<code>1.3</code>，<code>1.3.0-beta3</code>，<code>1.0-20150201.131010-1</code></p>
</li>
<li>
<p>一个Maven风格的版本范围：例如</p>
<pre><code class="language-java">[1.0,)
</code></pre>
<pre><code class="language-java">[1.1, 2.0)
</code></pre>
<pre><code class="language-java">(1.2, 1.5]
</code></pre>
<ul>
<li><code>[</code>和<code>]</code>的符号表示包含性约束; <code>(</code>和<code>)</code>表示排他性约束。</li>
<li>当上界或下界缺失时，该范围没有上界或下界。</li>
<li>符号<code>]</code>可以被用来代替<code>(</code>用于排他性下界，<code>[</code>代替<code>)</code>用于排他性上界。例如<code>]1.0, 2.0[</code></li>
</ul>
</li>
<li>
<p>前缀版本范围：例如</p>
<pre><code class="language-java">1.+
</code></pre>
<pre><code class="language-java">1.3.+
</code></pre>
<ul>
<li>仅包含与<code>+</code>之前部分完全匹配的版本。</li>
<li><code>+</code>本身的范围将包括任何版本。</li>
</ul>
</li>
<li>
<p>一个latest-status版本：例如latest.integration，latest.release</p>
</li>
<li>
<p>Maven的SNAPSHOT版本标识符：例如1.0-SNAPSHOT，1.4.9-beta1-SNAPSHOT</p>
</li>
</ul>
<h3 id="版本排序">版本排序</h3>
<ul>
<li>每个版本均分为其组成的“部分”：
<ul>
<li>字符[. - _ +]用于分隔版本的不同“部分”。</li>
<li>同时包含数字和字母的任何部分都将分为以下各个部分： <code>1a1 == 1.a.1</code></li>
<li>仅比较版本的各个部分。实际的分隔符并不重要：<code>1.a.1 == 1-a+1 == 1.a-1 == 1a1</code></li>
</ul>
</li>
<li>使用以下规则比较2个版本的等效部分：
<ul>
<li>如果两个部分都是数字，则最高数字值 较高 ：<code>1.1&lt;1.2</code></li>
<li>如果一个部分是数值，则认为它 高于 非数字部分：<code>1.a&lt;1.1</code></li>
<li>如果两个部分都不是数字，则按字母顺序比较，区分大小写：<code>1.A&lt; 1.B&lt; 1.a&lt;1.b</code></li>
<li>有额外数字部分的版本被认为比没有数字部分的版本高：<code>1.1&lt;1.1.0</code></li>
<li>带有额外的非数字部分的版本被认为比没有数字部分的版本低：<code>1.1.a&lt;1.1</code></li>
</ul>
</li>
<li>某些字符串值出于排序目的具有特殊含义：
<ul>
<li>字符串dev被认为比任何其他字符串部分低：<code>1.0-dev&lt; 1.0-alpha&lt; 1.0-rc</code>。</li>
<li>字符串rc、release和final被认为比任何其他字符串部分都高（按顺序排列：<code>1.0-zeta&lt; 1.0-rc&lt; 1.0-release&lt; 1.0-final&lt; 1.0</code>。</li>
<li>字符串SNAPSHOT没有特殊意义，和其他字符串部分一样按字母顺序排序：<code>1.0-alpha&lt; 1.0-SNAPSHOT&lt; 1.0-zeta&lt; 1.0-rc&lt; 1.0</code>。</li>
<li>数值快照版本没有特殊意义，和其他数值部分一样进行排序：<code>1.0&lt; 1.0-20150201.121010-123&lt; 1.1</code>。</li>
</ul>
</li>
</ul>
<p>简单来说:数字&gt;final&gt;release&gt;rc&gt;字母&gt;dev</p>
<h3 id="声明没有版本的依赖">声明没有版本的依赖</h3>
<p>对于较大的项目，建议的做法是声明没有版本的依赖项， 并将依赖项约束 用于版本声明。 优势在于，依赖关系约束使您可以在一处管理所有依赖关系的版本，包括可传递的依赖关系。</p>
<p>build.gradle</p>
<pre><code class="language-java">dependencies {
    implementation 'org.springframework:spring-web'
}
 
dependencies {
    constraints {
        implementation 'org.springframework:spring-web:5.0.2.RELEASE'
    }
}
</code></pre>
<h3 id="依赖方式-3">依赖方式</h3>
<h4 id="strictly">strictly</h4>
<blockquote>
<p>与该版本符号不匹配的任何版本将被排除。这是最强的版本声明。<br>
在声明的依赖项上，strictly可以降级版本。<br>
在传递依赖项上，如果无法选择此子句可接受的版本，将导致依赖项解析失败。<br>
有关详细信息，请参见覆盖依赖项版本。<br>
该术语支持动态版本。</p>
</blockquote>
<p>定义后，将覆盖先前的require声明并清除之前的 reject。</p>
<h4 id="require">require</h4>
<blockquote>
<p>表示所选版本不能低于require可接受的版本，但可以通过冲突解决方案提高，即使更高版本具有排他性更高的界限。<br>
这就是依赖项上的直接版本所转换的内容。该术语支持动态版本。</p>
</blockquote>
<p>定义后，将覆盖先前的strictly声明并清除之前的 reject。</p>
<h4 id="prefer">prefer</h4>
<blockquote>
<p>这是一个非常软的版本声明。仅当对该模块的版本没有更强的非动态观点时，才适用。<br>
该术语不支持动态版本。</p>
</blockquote>
<p>定义可以补充strictly或require。</p>
<p>在级别层次结构之外还有一个附加术语：</p>
<h4 id="reject">reject</h4>
<blockquote>
<p>声明模块不接受特定版本。如果唯一的可选版本也被拒绝，这将导致依赖项解析失败。该术语支持动态版本。</p>
</blockquote>
<h3 id="动态版本">动态版本</h3>
<p>build.gradle</p>
<pre><code class="language-java">plugins {
    id 'java-library'
}
 
repositories {
    mavenCentral()
}
 
dependencies {
    implementation 'org.springframework:spring-web:5.+'
}
</code></pre>
<h3 id="版本快照">版本快照</h3>
<p>声明一个版本变化的依赖</p>
<p>build.gradle</p>
<pre><code class="language-java"> 
plugins {
    id 'java-library'
}
 
repositories {
    mavenCentral()
    maven {
        url 'https://repo.spring.io/snapshot/'
    }
}
 
dependencies {
    implementation 'org.springframework:spring-web:5.0.3.BUILD-SNAPSHOT'
}
 
</code></pre>
<h3 id="以编程方式控制依赖项缓存">以编程方式控制依赖项缓存</h3>
<p>您可以使用ResolutionStrategy 对配置进行编程来微调缓存的某些方面。 如果您想永久更改设置，则编程方式非常有用。</p>
<p>默认情况下，Gradle将动态版本缓存24小时。 要更改Gradle将解析后的版本缓存为动态版本的时间，请使用：</p>
<p>例.动态版本缓存控制</p>
<p>build.gradle</p>
<pre><code class="language-java">configurations.all {
    resolutionStrategy.cacheDynamicVersionsFor 10, 'minutes'
}
 
</code></pre>
<p>默认情况下，Gradle会将更改的模块缓存24小时。 要更改Gradle将为更改的模块缓存元数据和工件的时间，请使用：</p>
<p>例.改变模块缓存控制</p>
<p>build.gradle</p>
<pre><code class="language-java">configurations.all {
    resolutionStrategy.cacheChangingModulesFor 4, 'hours'
}
</code></pre>
<h3 id="锁定配置">锁定配置</h3>
<p>锁定特定配置</p>
<p>build.gradle</p>
<pre><code class="language-java">configurations {
    compileClasspath {
        resolutionStrategy.activateDependencyLocking()
    }
}
</code></pre>
<p>锁定所有配置</p>
<p>build.gradle</p>
<pre><code class="language-java">dependencyLocking {
    lockAllConfigurations()
}
</code></pre>
<p>解锁特定配置</p>
<p>build.gradle</p>
<pre><code class="language-java">configurations {
    compileClasspath {
        resolutionStrategy.deactivateDependencyLocking()
    }
}
</code></pre>
<h4 id="锁定buildscript类路径配置">锁定buildscript类路径配置</h4>
<p>如果将插件应用于构建，则可能还需要利用依赖锁定。为了锁定用于脚本插件的classpath配置，请执行以下操作：</p>
<p>build.gradle</p>
<pre><code class="language-java">buildscript {
    configurations.classpath {
        resolutionStrategy.activateDependencyLocking()
    }
}
 
</code></pre>
<h4 id="使用锁定模式微调依赖项锁定行为">使用锁定模式微调依赖项锁定行为</h4>
<p>虽然默认锁定模式的行为如上所述，但是还有其他两种模式可用：</p>
<ul>
<li>Strict模式 ：在该模式下，除了上述验证外，如果被标记为锁定的配置没有与之相关联的锁定状态，则依赖性锁定将失败。</li>
<li>Lenient模式：在这种模式下，依存关系锁定仍将固定动态版本，但除此之外，依赖解析的变化不再是错误。</li>
</ul>
<p>锁定模式可以从dependencyLocking块中进行控制，如下所示：</p>
<p>build.gradle</p>
<pre><code class="language-java">dependencyLocking {
    lockMode = LockMode.STRICT
}
</code></pre>
<h3 id="版本冲突">版本冲突</h3>
<p>用force强制执行一个依赖版本</p>
<p>build.gradle</p>
<pre><code class="language-java">dependencies {
    implementation 'org.apache.httpcomponents:httpclient:4.5.4'
    implementation('commons-codec:commons-codec:1.9') {
        force = true
    }
}
</code></pre>
<p>排除特定依赖声明的传递依赖</p>
<p>build.gradle</p>
<pre><code class="language-java">dependencies {
    implementation('commons-beanutils:commons-beanutils:1.9.4') {
        exclude group: 'commons-collections', module: 'commons-collections'
    }
}
</code></pre>
<p>版本冲突时失败</p>
<p>build.gradle</p>
<pre><code class="language-java">configurations.all {
    resolutionStrategy {
        failOnVersionConflict()
    }
}
 
</code></pre>
<p>使用动态版本时失败</p>
<p>build.gradle</p>
<pre><code class="language-java">configurations.all {
    resolutionStrategy {
        failOnDynamicVersions()
    }
}
</code></pre>
<p>改变版本时失败</p>
<p>build.gradle</p>
<pre><code class="language-java">configurations.all {
    resolutionStrategy {
        failOnChangingVersions()
    }
}
</code></pre>
<p>解析无法再现时失败</p>
<p>build.gradle</p>
<pre><code class="language-java">configurations.all {
    resolutionStrategy {
        failOnNonReproducibleResolution()
    }
}
 
</code></pre>
<h1 id="插件">插件</h1>
<p>插件作用：将插件应用于项目可以使插件扩展项目的功能。它可以执行以下操作：</p>
<ul>
<li>扩展Gradle模型（例如，添加可以配置的新DSL元素）</li>
<li>根据约定配置项目（例如，添加新任务或配置合理的默认值）</li>
<li>应用特定的配置（例如，添加组织存储库或强制执行标准）</li>
</ul>
<p>简单来说，插件可以拓展项目功能，如任务，依赖，拓展属性，约束</p>
<h2 id="插件类型">插件类型</h2>
<ul>
<li>二进制插件 ：通过实现插件接口以编程方式编写二进制插件，或使用Gradle的一种DSL语言以声明方式编写二进制插件</li>
<li>脚本插件 ：脚本插件是其他构建脚本，可以进一步配置构建，并通常采用声明式方法来操纵构建</li>
</ul>
<p>插件通常起初是脚本插件（因为它们易于编写），然后，随着代码变得更有价值，它被迁移到可以轻松测试并在多个项目或组织之间共享的二进制插件。</p>
<h2 id="应用插件">应用插件</h2>
<h3 id="二进制插件">二进制插件</h3>
<p>实现了org.gradle.api.Plugin接口</p>
<pre><code class="language-java">apply plugin: 'com.android.application'
</code></pre>
<h4 id="apply-plugin">apply plugin</h4>
<pre><code class="language-java">apply plugin: 'java'  //id
==
apply plugin: org.gradle.api.plugins.JavaPlugin //类型
==
apply plugin: JavaPlugin          //org.gradle.api.plugins默认导入
</code></pre>
<h4 id="plugins-dsl">plugins DSL</h4>
<pre><code class="language-java">plugins {
    id 'java' //应用核心插件
    id 'com.jfrog.bintray' version '0.4.1' //应用社区插件
    id 'com.example.hello' version '1.0.0' apply false //使用`apply false`语法告诉Gradle不要将插件应用于当前项目
}
</code></pre>
<h3 id="脚本插件">脚本插件</h3>
<p>脚本插件会自动解析，可以从本地文件系统或远程位置的脚本中应用。可以将多个脚本插件（任意一种形式）应用于给定目标。</p>
<pre><code class="language-java">apply from:'version.gradle'
</code></pre>
<p>apply可传入内容</p>
<pre><code class="language-java">void apply(Map&lt;String,? options);
void apply(Closure closure);
void apply(Action&lt;? super ObjectConfigurationAction&gt; action);
</code></pre>
<h2 id="定义插件">定义插件</h2>
<p>定义一个带有ID的buildSrc插件<br>
buildSrc / build.gradle</p>
<pre><code class="language-java">plugins {
    id 'java-gradle-plugin'
}
gradlePlugin {
    plugins {
        myPlugins {
            id = 'my-plugin'
            implementationClass = 'my.MyPlugin'
        }
    }
}
</code></pre>
<h2 id="第三方插件">第三方插件</h2>
<p>通过将插件添加到构建脚本classpath中，然后应用该插件，可以将已发布为外部jar文件的二进制插件添加到项目中。可以使用buildscript {}块将外部jar添加到构建脚本classpath中。</p>
<pre><code class="language-java">buildscript {
    repositories {
        google()
        jcenter()
    }
    dependencies {
        classpath &quot;com.android.tools.build:gradle:4.0.1&quot;
    }
}
</code></pre>
<h2 id="插件管理">插件管理</h2>
<p>pluginManagement {}块只能出现在settings.gradle文件中，必须是文件中的第一个块，也可以以settings形式出现在初始化脚本中。</p>
<p>settings.gradle</p>
<pre><code class="language-java">pluginManagement {
    plugins {
    }
    resolutionStrategy {
    }
    repositories {
    }
}
rootProject.name = 'plugin-management'
</code></pre>
<p>init.gradle</p>
<pre><code class="language-java">settingsEvaluated { settings -&gt;
    settings.pluginManagement {
        plugins {
        }
        resolutionStrategy {
        }
        repositories {
        }
    }
}
</code></pre>
<p>例：通过pluginManagement管理插件版本。</p>
<p>settings.gradle</p>
<pre><code class="language-java">pluginManagement {
  plugins {
        id 'com.example.hello' version &quot;${helloPluginVersion}&quot;
  }
}
 
</code></pre>
<p>gradle.properties</p>
<pre><code class="language-java">helloPluginVersion=1.0.0
</code></pre>
<h2 id="自定义插件存储库">自定义插件存储库</h2>
<p>要指定自定义插件存储库，请使用repositories {}块其中的pluginManagement {}：</p>
<p>settings.gradle</p>
<pre><code class="language-java">pluginManagement {
    repositories {
        maven {
            url '../maven-repo'
        }
        gradlePluginPortal()
        ivy {
            url '../ivy-repo'
        }
    }
}
</code></pre>
<h1 id="java库">java库</h1>
<p>导入java</p>
<pre><code class="language-java">apply plugin:'java'
</code></pre>
<p>自定义路径</p>
<pre><code class="language-java">sourceSets {
    main {
         java {
            srcDirs = ['src']
         }
    }
 
    test {
        java {
            srcDirs = ['test']
        }
    }
}
sourceSets {
    main {
        java {
            srcDir 'thirdParty/src/main/java'
        }
    }
}
</code></pre>
<p>导入依赖</p>
<pre><code class="language-java"> repositories {
        jcenter()
 }
dependencies {
     implementation group:'com.android.support',name:'appcompat-v7',version:'28.0.0'
     implementation 'com.android.support:appcompat-v7:28.0.0'
     implementation protect(':p')
     implementation file('libs/ss.jar','libs/ss2.jar')
         
    implementation fileTree(dir: &quot;libs&quot;, include: [&quot;*.jar&quot;])
}
</code></pre>
<p>多项目 设置 settings.gradle</p>
<pre><code class="language-java">include ':app'
rootProject.name = &quot;GradleTest&quot;
</code></pre>
<h1 id="安卓实用">安卓实用</h1>
<h2 id="设置签名">设置签名</h2>
<pre><code class="language-java">android  {
    signingConfig = {
        release {
            storeFile file(&quot;MYKEY.keystore&quot;)
            storePassword &quot;storePassword&quot;
            keyAlias &quot;keyAlias&quot;
            keyPassword &quot;keyPassword&quot;
        }
    }
}
</code></pre>
<h2 id="自定义输出apk文件名称">自定义输出apk文件名称</h2>
<pre><code class="language-java">applicationVariants.all { variant -&gt;
       variant.outputs.all { output -&gt;
           def fileName = &quot;自定义名称_${variant.versionName}_release.apk&quot;
           def outFile = output.outputFile
           if (outFile != null &amp;&amp; outFile.name.endsWith('.apk')) {
               outputFileName = fileName
           }
       }
   }
</code></pre>
<h2 id="动态androidmanifest">动态AndroidManifest</h2>
<pre><code class="language-java">&lt;meta-data android:name=&quot;paramName&quot; android:value=&quot;${PARAM_NAME}&quot;&gt;
android {
    productFlavors{
        google{
            manifestPlaceholders.put(&quot;PARAM_NAME&quot;,'google')
        }
    }
}
</code></pre>
<h2 id="多渠道">多渠道</h2>
<pre><code class="language-java">android {
    productFlavors{
        google{
            
        },
        baidu{
            
        }
    }
    productFlavors.all{ flavor-&gt;
        manifestPlaceholders.put(&quot;PARAM_NAME&quot;,name)
    }
}
</code></pre>
<h2 id="adb设置">adb设置</h2>
<p>adb工具</p>
<pre><code class="language-java">android {
    adbOptions{
        timeOutInMs = 5000 //5s超时
        installOptions '-r','-s' //安装指令
    }
}
</code></pre>
<h2 id="dexoptions">dexOptions</h2>
<p>dex工具</p>
<pre><code class="language-java">android {
    dexOptions{
        incremental true //增量
        javaMaxHeapSize '4G'//dx最大队内存
        jumboMode true //强制开启jumbo跳过65535限制
        preDexLibraries true //提高增量构建速度
            threadCount 1 //dx线程数量
    }
}
</code></pre>
<h2 id="ant">Ant</h2>
<p>例.将嵌套元素传递给Ant任</p>
<p>build.gradle</p>
<pre><code class="language-java">task zip {
    doLast {
        ant.zip(destfile: 'archive.zip') {
            fileset(dir: 'src') {
                include(name: '**.xml')
                exclude(name: '**.java')
            }
        }
    }
}
</code></pre>
<p>例.使用Ant类型</p>
<p>build.gradle</p>
<pre><code class="language-java">task list {
    doLast {
        def path = ant.path {
            fileset(dir: 'libs', includes: '*.jar')
        }
        path.list().each {
            println it
        }
    }
}
</code></pre>
<p>例.使用定制的Ant任务</p>
<p>build.gradle</p>
<pre><code class="language-java">task check {
    doLast {
        ant.taskdef(resource: 'checkstyletask.properties') {
            classpath {
                fileset(dir: 'libs', includes: '*.jar')
            }
        }
        ant.checkstyle(config: 'checkstyle.xml') {
            fileset(dir: 'src')
        }
    }
}
</code></pre>
<h2 id="lint">Lint</h2>
<p>Lint：android tool目录下的工具，一个代码扫描工具，能够帮助我们识别资源、代码结构存在的问题</p>
<pre><code class="language-java">lintOptions
android {
    lintOptions{
        abortOnError true //发生错误时推出Gradle
        absolutePaths true //配置错误输出是否显示绝对路径
        check 'NewApi','InlinedApi' // 检查lint check的issue id            
        enable 'NewApi','InlinedApi' //启动 lint check的issue id
        disable 'NewApi','InlinedApi' //关闭 lint check的issue id
        checkAllWarnings true //检查所有警告issue
        ignoreWarning true //忽略警告检查，默认false
        checkReleaseBuilds true //检查致命错误，默认true
        explainIssues true //错误报告是否包含解释说明，默认true
        htmlOutput new File(&quot;/xx.html&quot;) //html报告输出路径
        htmlReport true // 是否生成html报告，默认true
        lintConfig new File(&quot;/xx.xml&quot;) //lint配置
        noLines true // 输出不带行号 默认true
        quite true // 安静模式
        showAll true //是否显示所有输出，不截断
    }
}
</code></pre>

          <div class="toc-container"><ul class="markdownIt-TOC">
<li><a href="#%E4%BE%9D%E8%B5%96">依赖</a>
<ul>
<li><a href="#configurations">configurations</a></li>
<li><a href="#%E4%BE%9D%E8%B5%96%E6%96%B9%E5%BC%8F">依赖方式</a>
<ul>
<li><a href="#%E6%A8%A1%E5%9D%97%E4%BE%9D%E8%B5%96">模块依赖</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E4%BE%9D%E8%B5%96">文件依赖</a></li>
<li><a href="#%E9%A1%B9%E7%9B%AE%E4%BE%9D%E8%B5%96">项目依赖</a></li>
</ul>
</li>
<li><a href="#%E4%BE%9D%E8%B5%96%E6%96%B9%E5%BC%8F-2">依赖方式</a></li>
<li><a href="#repositories">repositories</a>
<ul>
<li><a href="#%E5%A3%B0%E6%98%8E%E5%AD%98%E5%82%A8%E5%BA%93%E8%BF%87%E6%BB%A4%E5%99%A8">声明存储库过滤器</a></li>
<li><a href="#%E5%88%86%E5%89%B2%E5%BF%AB%E7%85%A7%E5%92%8C%E5%8F%91%E8%A1%8C%E7%89%88">分割快照和发行版</a></li>
<li><a href="#%E6%94%AF%E6%8C%81%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE%E6%BA%90">支持的元数据源</a></li>
</ul>
</li>
<li><a href="#gav%E5%9D%90%E6%A0%87">GAV坐标</a></li>
<li><a href="#%E5%8F%98%E4%BD%93">变体</a>
<ul>
<li><a href="#%E5%A3%B0%E6%98%8E%E5%8A%9F%E8%83%BD%E5%8F%98%E4%BD%93">声明功能变体</a></li>
</ul>
</li>
<li><a href="#%E5%85%83%E6%95%B0%E6%8D%AE">元数据</a></li>
<li><a href="#%E5%B9%B3%E5%8F%B0">平台</a>
<ul>
<li><a href="#%E4%BD%BF%E7%94%A8%E5%B9%B3%E5%8F%B0">使用平台</a></li>
</ul>
</li>
<li><a href="#capability">Capability</a>
<ul>
<li><a href="#%E5%A3%B0%E6%98%8E%E7%BB%84%E4%BB%B6%E7%9A%84capability">声明组件的capability</a></li>
<li><a href="#%E8%A7%A3%E5%86%B3%E5%86%B2%E7%AA%81">解决冲突</a></li>
</ul>
</li>
<li><a href="#%E7%89%88%E6%9C%AC">版本</a>
<ul>
<li><a href="#%E7%89%88%E6%9C%AC%E8%A7%84%E5%88%99">版本规则</a></li>
<li><a href="#%E7%89%88%E6%9C%AC%E6%8E%92%E5%BA%8F">版本排序</a></li>
<li><a href="#%E5%A3%B0%E6%98%8E%E6%B2%A1%E6%9C%89%E7%89%88%E6%9C%AC%E7%9A%84%E4%BE%9D%E8%B5%96">声明没有版本的依赖</a></li>
<li><a href="#%E4%BE%9D%E8%B5%96%E6%96%B9%E5%BC%8F-3">依赖方式</a>
<ul>
<li><a href="#strictly">strictly</a></li>
<li><a href="#require">require</a></li>
<li><a href="#prefer">prefer</a></li>
<li><a href="#reject">reject</a></li>
</ul>
</li>
<li><a href="#%E5%8A%A8%E6%80%81%E7%89%88%E6%9C%AC">动态版本</a></li>
<li><a href="#%E7%89%88%E6%9C%AC%E5%BF%AB%E7%85%A7">版本快照</a></li>
<li><a href="#%E4%BB%A5%E7%BC%96%E7%A8%8B%E6%96%B9%E5%BC%8F%E6%8E%A7%E5%88%B6%E4%BE%9D%E8%B5%96%E9%A1%B9%E7%BC%93%E5%AD%98">以编程方式控制依赖项缓存</a></li>
<li><a href="#%E9%94%81%E5%AE%9A%E9%85%8D%E7%BD%AE">锁定配置</a>
<ul>
<li><a href="#%E9%94%81%E5%AE%9Abuildscript%E7%B1%BB%E8%B7%AF%E5%BE%84%E9%85%8D%E7%BD%AE">锁定buildscript类路径配置</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E9%94%81%E5%AE%9A%E6%A8%A1%E5%BC%8F%E5%BE%AE%E8%B0%83%E4%BE%9D%E8%B5%96%E9%A1%B9%E9%94%81%E5%AE%9A%E8%A1%8C%E4%B8%BA">使用锁定模式微调依赖项锁定行为</a></li>
</ul>
</li>
<li><a href="#%E7%89%88%E6%9C%AC%E5%86%B2%E7%AA%81">版本冲突</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%8F%92%E4%BB%B6">插件</a>
<ul>
<li><a href="#%E6%8F%92%E4%BB%B6%E7%B1%BB%E5%9E%8B">插件类型</a></li>
<li><a href="#%E5%BA%94%E7%94%A8%E6%8F%92%E4%BB%B6">应用插件</a>
<ul>
<li><a href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%8F%92%E4%BB%B6">二进制插件</a>
<ul>
<li><a href="#apply-plugin">apply plugin</a></li>
<li><a href="#plugins-dsl">plugins DSL</a></li>
</ul>
</li>
<li><a href="#%E8%84%9A%E6%9C%AC%E6%8F%92%E4%BB%B6">脚本插件</a></li>
</ul>
</li>
<li><a href="#%E5%AE%9A%E4%B9%89%E6%8F%92%E4%BB%B6">定义插件</a></li>
<li><a href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8F%92%E4%BB%B6">第三方插件</a></li>
<li><a href="#%E6%8F%92%E4%BB%B6%E7%AE%A1%E7%90%86">插件管理</a></li>
<li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8F%92%E4%BB%B6%E5%AD%98%E5%82%A8%E5%BA%93">自定义插件存储库</a></li>
</ul>
</li>
<li><a href="#java%E5%BA%93">java库</a></li>
<li><a href="#%E5%AE%89%E5%8D%93%E5%AE%9E%E7%94%A8">安卓实用</a>
<ul>
<li><a href="#%E8%AE%BE%E7%BD%AE%E7%AD%BE%E5%90%8D">设置签名</a></li>
<li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BE%93%E5%87%BAapk%E6%96%87%E4%BB%B6%E5%90%8D%E7%A7%B0">自定义输出apk文件名称</a></li>
<li><a href="#%E5%8A%A8%E6%80%81androidmanifest">动态AndroidManifest</a></li>
<li><a href="#%E5%A4%9A%E6%B8%A0%E9%81%93">多渠道</a></li>
<li><a href="#adb%E8%AE%BE%E7%BD%AE">adb设置</a></li>
<li><a href="#dexoptions">dexOptions</a></li>
<li><a href="#ant">Ant</a></li>
<li><a href="#lint">Lint</a></li>
</ul>
</li>
</ul>
</div>
          
              <hr />
            
          
            
            <p class="next-post">上一篇：
                <a href="https://tinaxiawuhao.github.io/post/wYNztHepH/">
                  <span class="post-title">
                    gradle-Logging&rarr;
                  </span>
                </a>
              </p>
            
          
            
           <p class="prev-post">下一篇：
                 <a href="https://tinaxiawuhao.github.io/post/GALzQf_b-/">
                   <span class="post-title">
                     list、set、map等集合类线程不安全的问题及解决方法&rarr;
                   </span>
                 </a>
               </p>
          
          <div class="comment" style="text-align: center;">
            

            
            
          </div>
        </div>
      </div>
  </article>
  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <ul class="list-inline text-center">
            
            
            <li class="list-inline-item">
              <a href="https://github.com/tinaxiawuhao" target="_blank">
                <span class="fa-stack fa-lg">
                  <i class="fas fa-circle fa-stack-2x"></i>
                  <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
            
              
            
              
            
              
            
              
            
              
            
              
            
              
              <!-- <li class="list-inline-item">
              <a href="https://tinaxiawuhao.github.io/atom.xml" target="_blank">
                <span class="fa-stack fa-lg">
                  <i class="fas fa-circle fa-stack-2x"></i>
                  <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
                </span>
              </a>
              </li> -->
          </ul>
          <p class="copyright text-muted">Copyright &copy;<span>tianxia</span><br><a href="https://github.com/getgridea/gridea" class="Themeinfo">Powered by Gridea</a></p>
        </div>
      </div>
    </div>
   </footer>
  <!-- Bootstrap core JavaScript -->
  <script src="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
  <!-- <script src="https://tinaxiawuhao.github.io/media/scripts/bootstrap.bundle.min.js"></script> -->
  <!-- Bootstrap core JavaScript -->
  <script src="https://cdn.jsdelivr.net/gh/Alanrk/clean-cdn@1.0/scripts/clean-blog.min.js"></script>
  <!-- <script src="https://tinaxiawuhao.github.io/media/scripts/clean-blog.min.js"></script> -->
  <style type="text/css">a.back_to_top{text-decoration:none;position:fixed;bottom:40px;right:30px;background:#f0f0f0;height:40px;width:40px;border-radius:50%;line-height:36px;font-size:18px;text-align:center;transition-duration:.5s;transition-propety:background-color;display:none}a.back_to_top span{color:#888}a.back_to_top:hover{cursor:pointer;background:#dfdfdf}a.back_to_top:hover span{color:#555}@media print,screen and(max-width:580px){.back_to_top{display:none!important}}</style>
<a id="back_to_top" href="#" class="back_to_top">
  <span>▲</span></a>
<script>$(document).ready((function(_this) {
    return function() {
      var bt;
      bt = $('#back_to_top');
      if ($(document).width() > 480) {
        $(window).scroll(function() {
          var st;
          st = $(window).scrollTop();
          if (st > 30) {
            return bt.css('display', 'block')
          } else {
            return bt.css('display', 'none')
          }
        });
        return bt.click(function() {
          $('body,html').animate({
            scrollTop: 0
          },
          800);
          return false
        })
      }
    }
  })(this));</script>
  
  <div id="landlord-parent">
    <div id="landlord">
        <div class="message" style="opacity:0"></div>
        <canvas id="live2d" width="240" height="250" class="live2d"></canvas>
    </div>
</div>

<script type="text/javascript">
    if (/(iPhone|iPad|iPod|iOS|Android)/i.test(navigator.userAgent)) {
        //移动端
        console.log("------ 移动端");
    } else {
        console.log("------ PC端 " + navigator.userAgent);

        addScript("https://cdn.jsdelivr.net/gh/850552586/ericamcdn@0.1/js/live2d.js", () => {
            // 加载完成后再loadlive2d
            loadlive2d("live2d", "https://tinaxiawuhao.github.io/media/live2d/assets/tororo.model.json");
        });

        var home_Path = "https://tinaxiawuhao.github.io/";
        addScript("https://tinaxiawuhao.github.io/media/live2d/js/message.js", () => { });
    }

    // 插入js文件，完成后callback
    function addScript(jsfile, callback) {
        var landlord_parent = document.getElementById("landlord-parent");
        var script = document.createElement("script");
        script.type = "text/javascript";
        script.src = jsfile;
        landlord_parent.appendChild(script);
        script.onload = script.onreadystatechange = function () {
            if (!this.readyState || this.readyState === "loaded" || this.readyState === "complete") {
                script.onload = script.onreadystatechange = null;
                if (callback && typeof callback == "function") {
                    callback(); //window[callback]();如果传递字符串过来 调用window['函数名']() 调用方法
                }
            }
        };
    }
</script>
  
  <script src="https://tinaxiawuhao.github.io/media/scripts/tocScript.js"></script>
</body>

</html>